!function(n){var t={};function o(e){if(t[e])return t[e].exports;var i=t[e]={i:e,l:!1,exports:{}};return n[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=n,o.c=t,o.d=function(n,t,e){o.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:e})},o.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},o.t=function(n,t){if(1&t&&(n=o(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var i in n)o.d(e,i,function(t){return n[t]}.bind(null,i));return e},o.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return o.d(t,"a",t),t},o.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},o.p="",o(o.s=601)}({122:function(n,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tinymceInit=function(){tinymce.init({menubar:!1,selector:"textarea",forced_root_block:!1,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace visualblocks visualchars codesample fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:["styleselect | bold italic codesample | link image | bullist numlist outdent indent | forecolor backcolor"],paste_as_text:!0,branding:!1,width:"calc(100% - 2px)",setup:function(n){n.on("change",function(){n.save()})}}),$(document).on("focusin",function(n){$(n.target).closest(".mce-window").length&&n.stopImmediatePropagation()})}},20:function(n,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCookie=function(n){var t=null;if(document.cookie&&""!=document.cookie)for(var o=document.cookie.split(";"),e=0;e<o.length;e++){var i=o[e].trim();if(i.substring(0,n.length+1)==n+"="){t=decodeURIComponent(i.substring(n.length+1));break}}return t},t.getUrlFormat=function(n,t){var o=n+"?";for(var e in t)o=o+e+"="+t[e]+"&";return o},t.imgLoad=function(n,t){var o=setInterval(function(){n.complete&&(t(n),clearInterval(o))},8)},t.hexToRgb=function(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,o,e){return t+t+o+o+e+e});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},t.formatOpenCoterieDocumentUrl=function(n,t){return"/coteries/"+t+"/documents/"+n.title.replace(/\s/g,"-")+"/"+n.pk},t.formatOpenDocumentUrl=function(n){return"/documents/"+n.title.replace(/\s/g,"-")+"/"+n.pk}},601:function(n,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findTargetAnnotation=t.scrollAnnotationDivIntoView=t.addAnnotationRelatedListenerWithin=t.addAnnotationRelatedListener=void 0;var e=o(20),i=o(122);function a(n){(function(n){return $(".AnnotationDiv[annotation_id='"+n+"']")})(n).remove(),$(".Annotation[annotation_id='"+n+"']").remove()}function r(n){return parseFloat($(n).css("left"))}function l(n){return parseFloat($(n).css("left"))+$(n).width()}function c(n){return parseFloat($(n).css("top"))}function s(n){return parseFloat($(n).css("top"))+$(n).height()}function d(n){n.find("code").addClass("prettyprint"),PR.prettyPrint(),n.find(".AnnotationBlock").on("mouseover",function(){var n=$(this).attr("annotation_id"),t=$(".Annotation[annotation_id='"+n+"']");$(this).css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)"),t.css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)")}),n.find(".AnnotationBlock").on("mouseout",function(){var n=$(this).attr("annotation_id"),t=$(".Annotation[annotation_id='"+n+"']");$(this).css("box-shadow","none"),t.css("box-shadow","none")}),n.find(".AnnotationDirectButton").on("click",function(n){var t=$(this).parents(".AnnotationDiv").attr("annotation_id"),o=$(".Annotation[annotation_id='"+t+"']"),e=$("#file_viewer"),i=o.offset().top-e.offset().top+e.scrollTop()-.38*window.innerHeight+o.height()/2;e.animate({scrollTop:parseInt(i)},240)}),n.find(".PostReplyReplyButton").on("click",function(){if(is_authenticated){var n=!this.classList.contains("AnonymouslyPostReplyReplyButton"),t=$(this),o=layer.load(1,{shade:.18});$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,e.getCookie)("csrftoken"),operation:"reply_annotation",annotation_reply_content:t.parents("form").find("textarea[name='reply_reply_content']").val(),reply_to_annotation_id:t.parents(".AnnotationBlock").find(".PostAnnotationReplyButton").val(),reply_to_annotation_reply_id:t.val(),document_id:$("button[name='document_id']").val(),is_public:n},success:function(n){var e=$(n);$(".AnnotationBlock[annotation_id='"+t.parents(".AnnotationBlock").find(".PostAnnotationReplyButton").val(),NaN).append(e),$(".ReplyAnnotationButton").parents("footer").children("form").css("display","none"),tinyMCE.activeEditor.setContent(""),d(e),(0,i.tinymceInit)(),layer.close(o)}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),n.find(".DeleteAnnotationReplyButton").on("click",function(){var n=layer.load(1,{shade:.18}),t=this.value;$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,e.getCookie)("csrftoken"),operation:"delete_annotation_reply",reply_id:t,document_id:$("button[name='document_id']").val()},success:function(o){!function(n){for(var t=$(".AnnotationReplyBlock[annotation_reply_id='"+n+"']").toArray();t.length>0;){var o=$(t.shift()),e=o.attr("annotation_reply_id");t=t.concat($(".AnnotationReplyBlock[reply_to_annotation_reply='"+e+"']").toArray()),o.remove()}}(t),layer.close(n)}})}),n.find(".PostAnnotationReplyButton").on("click",function(){if(is_authenticated){var n=!this.classList.contains("AnonymouslyPostAnnotationReplyButton"),t=$(this),o=layer.load(1,{shade:.18});$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,e.getCookie)("csrftoken"),operation:"reply_annotation",annotation_reply_content:t.parent("form").find("textarea[name='annotation_reply_content']").val(),reply_to_annotation_id:t.val(),document_id:$("button[name='document_id']").val(),is_public:n},success:function(n){var e=$(n);$(".AnnotationBlock[annotation_id='"+t.val()+"']").append(e),$(".ReplyAnnotationButton").parents("footer").children("form").css("display","none"),tinyMCE.activeEditor.setContent(""),d(e),(0,i.tinymceInit)(),layer.close(o)}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),n.find(".DeleteAnnotationButton").on("click",function(){var n=layer.load(1,{shade:.18}),t=this.value;$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,e.getCookie)("csrftoken"),operation:"delete_annotation",annotation_id:this.value},success:function(){a(t),layer.close(n)}})}),n.find(".LikeAnnotationButton").on("click",function(){if(is_authenticated){var n=$(this),t=parseInt(n.find(".num_like").text())+1;n.find(".num_like").text(t.toString()),n.off("click"),n.css("color","#6495ED"),n.on("click",function(){layer.msg("already liked",{icon:6,time:800})}),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,e.getCookie)("csrftoken"),operation:"like_annotation",annotation_id:n.attr("annotation_id")}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),n.find(".LikeAnnotationReplyButton").on("click",function(){if(is_authenticated){var n=$(this),t=parseInt(n.find(".num_like").text())+1;n.find(".num_like").text(t.toString()),n.off("click"),n.css("color","#6495ED"),n.on("click",function(){layer.msg("already liked",{icon:6,time:800})}),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,e.getCookie)("csrftoken"),operation:"like_annotation_reply",annotation_reply_id:n.attr("annotation_reply_id")}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),n.find(".ReplyAnnotationButton").on("click",function(){var n="none"===!$(this).css("display");$(this).parents("footer").children("form").slideToggle({duration:180,start:function(){n||$(".ReplyAnnotationButton").parents("footer").children("form").not($(this)).slideUp(180).css("display","none")}})}),n.find(".Annotation").addBack(".Annotation").on("mouseover",function(){var t=$(this).parent(".page_div").children(".PageCanvas"),o=$(this).parent(".page_div").find(".Annotation").toArray(),e=void 0;n.find(".Annotation").addBack(".Annotation").on("mousemove",function(n){if(0==n.which){var i=u(n,o,t);i!=e&&(void 0!=e&&(e.css("box-shadow","none"),$(".AnnotationBlock[annotation_id='"+$(e).attr("annotation_id")+"']").css("box-shadow","none")),i.css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)"),$(".AnnotationBlock[annotation_id='"+$(i).attr("annotation_id")+"']").css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)"),e=i)}else{var a=!0,r=!1,l=void 0;try{for(var c,s=o[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var d=c.value;$(d).css("box-shadow","none"),$(".AnnotationBlock[annotation_id='"+$(d).attr("annotation_id")+"']").css("box-shadow","none")}}catch(n){r=!0,l=n}finally{try{!a&&s.return&&s.return()}finally{if(r)throw l}}}})}),n.find(".Annotation").addBack(".Annotation").on("mouseout",function(n){if(0==n.which){var t=$(this).parent(".page_div").find(".Annotation").toArray(),o=!0,e=!1,i=void 0;try{for(var a,r=t[Symbol.iterator]();!(o=(a=r.next()).done);o=!0){var l=a.value;$(l).css("box-shadow","none"),$(".AnnotationBlock[annotation_id='"+$(l).attr("annotation_id")+"']").css("box-shadow","none"),$(l).off("mousemove")}}catch(n){e=!0,i=n}finally{try{!o&&r.return&&r.return()}finally{if(e)throw i}}}})}function u(n,t,o){var e=t.filter(function(t){return function(n,t,o){var e=t.pageX-o.offset().left,i=t.pageY-o.offset().top;return r(n)<=e&&l(n)>=e&&c(n)<=i&&s(n)>=i}(t,n,o)}),i=e.sort(function(n,t){return l(n)>l(t)});return l(i[1])-l(i[0])<9&&r((i=e.sort(function(n,t){return r(n)<r(t)}))[0])-r(i[1])<9&&s((i=e.sort(function(n,t){return s(n)>s(t)}))[1])-s(i[0])<9&&(i=e.sort(function(n,t){return c(n)<c(t)})),$(i[0])}t.addAnnotationRelatedListener=function(){d($(document))},t.addAnnotationRelatedListenerWithin=d,t.scrollAnnotationDivIntoView=function(n){var t=$("#annotation_update_div"),o=n.offset().top-t.offset().top+t.scrollTop();t.animate({scrollTop:parseInt(o)},240)},t.findTargetAnnotation=u}});