!function(t){var n={};function e(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,e),a.l=!0,a.exports}e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)e.d(o,a,function(n){return t[n]}.bind(null,a));return o},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=615)}({122:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.tinymceInit=function(){tinymce.init({menubar:!1,selector:"textarea",forced_root_block:!1,plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace visualblocks visualchars codesample fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:["styleselect | bold italic codesample | link image | bullist numlist outdent indent | forecolor backcolor"],paste_as_text:!0,branding:!1,width:"calc(100% - 2px)",setup:function(t){t.on("change",function(){t.save()})}}),$(document).on("focusin",function(t){$(t.target).closest(".mce-window").length&&t.stopImmediatePropagation()})}},20:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getCookie=function(t){var n=null;if(document.cookie&&""!=document.cookie)for(var e=document.cookie.split(";"),o=0;o<e.length;o++){var a=e[o].trim();if(a.substring(0,t.length+1)==t+"="){n=decodeURIComponent(a.substring(t.length+1));break}}return n},n.getUrlFormat=function(t,n){var e=t+"?";for(var o in n)e=e+o+"="+n[o]+"&";return e},n.imgLoad=function(t,n){var e=setInterval(function(){t.complete&&(n(t),clearInterval(e))},8)},n.hexToRgb=function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,n,e,o){return n+n+e+e+o+o});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},n.formatOpenCoterieDocumentUrl=function(t,n){return"/coteries/"+n+"/documents/"+t.slug+"/"+t.title.replace(/\s/g,"-")},n.formatOpenDocumentUrl=function(t){return"/documents/"+t.slug+"/"+t.title.replace(/\s/g,"-")}},599:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.prepareNavbarFunction=void 0;var o=e(20);n.prepareNavbarFunction=function(){$("#collect_button").on("click",function(){var t=$(this).find(".fa");t.hasClass("fa-star-o")?(layer.msg("Collected"),t.removeClass("fa-star-o"),t.addClass("fa-star"),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"collect",document_id:$("button[name='document_id']").val()}})):t.hasClass("fa-star")&&(layer.msg("Uncollected"),t.removeClass("fa-star"),t.addClass("fa-star-o"),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"uncollect",document_id:$("button[name='document_id']").val()}}))}),$("#show_annotation_frame_button").on("click",function(){$(".Annotation").each(function(){$(this).slideDown(180)})}),$("#hide_annotation_frame_button").on("click",function(){$(".Annotation").each(function(){$(this).slideUp(180)})})}},600:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.enablePostCommentButton=n.enableRefreshCommentButton=n.addCommentRelatedListener=void 0;var o=e(20),a=e(122);function i(){(0,a.tinymceInit)(),$("code").addClass("prettyprint"),PR.prettyPrint(),$(".likeCommentButton").on("click",function(){if(is_authenticated){var t=$(this),n=parseInt(t.next().text())+1;t.next().text(n.toString()),t.off("click"),t.css("color","#6495ED"),t.on("click",function(){layer.msg("already liked",{icon:6,time:800})}),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"like_comment",comment_id:t.attr("comment_id")}})}else layer.msg('<span style="color: #ECECEC">You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first</span>')}),$(".delete_comment_button").on("click",function(){if(is_authenticated){var t=layer.load(0,{shade:.18}),n=this.value;$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"delete_comment",comment_id:n,document_id:$("button[name='document_id']").val()},success:function(e){!function(t){for(var n=$(".CommentBlock[comment_id='"+t+"']").toArray();n.length>0;){var e=$(n.shift()),o=e.attr("comment_id");n=n.concat($(".CommentBlock[reply_to_comment_id='"+o+"']").toArray()),e.remove()}}(n),layer.close(t)}})}}),$(".reply_comment_button").on("click",function(){$(this).parents("blockquote").find(".reply_comment_form").slideToggle({duration:180,start:function(){$(this).is(":hidden")||$(".reply_comment_form").not($(this)).slideUp(180)}})}),$(".post_comment_reply_button").on("click",function(){if(is_authenticated){var t=!this.classList.contains("anonymously_post_comment_reply_button"),n=$(this),e=layer.load(0,{shade:.18});$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"comment",comment_content:n.parents("form").find("textarea[name='comment_content']").val(),document_id:$("button[name='document_id']").val(),reply_to_comment_id:n.val(),is_public:t},success:function(t){$("#comment_update_div").html(t),i(),layer.close(e)}})}else layer.msg('<span style="color: #ECECEC">You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first</span>')})}n.addCommentRelatedListener=i,n.enableRefreshCommentButton=function(){$("#refresh_comment_button").on("click",function(){$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"refresh",document_id:$("button[name='document_id']").val()},success:function(t){$("#comment_update_div").html(t),i()}})})},n.enablePostCommentButton=function(){$(".post_comment_button").on("click",function(){if(is_authenticated){var t=!this.classList.contains("anonymously_post_comment_button"),n=layer.load(0,{shade:.18}),e=tinyMCE.activeEditor;$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"comment",comment_content:$("textarea[name='comment_content']").val(),document_id:$("button[name='document_id']").val(),is_public:t},success:function(t){$("#comment_update_div").html(t),i(),e.setContent(""),layer.close(n)}})}else layer.msg('<span style="color: #ECECEC">You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first</span>')})}},601:function(t,n,e){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.findTargetAnnotation=n.scrollAnnotationDivIntoView=n.addAnnotationRelatedListenerWithin=n.addAnnotationRelatedListener=void 0;var o=e(20),a=e(122);function i(t){(function(t){return $(".AnnotationDiv[annotation_id='"+t+"']")})(t).remove(),$(".Annotation[annotation_id='"+t+"']").remove()}function r(t){return parseFloat($(t).css("left"))}function s(t){return parseFloat($(t).css("left"))+$(t).width()}function c(t){return parseFloat($(t).css("top"))}function l(t){return parseFloat($(t).css("top"))+$(t).height()}function d(t){t.find("code").addClass("prettyprint"),PR.prettyPrint(),t.find(".AnnotationBlock").on("mouseover",function(){var t=$(this).attr("annotation_id"),n=$(".Annotation[annotation_id='"+t+"']");$(this).css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)"),n.css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)")}),t.find(".AnnotationBlock").on("mouseout",function(){var t=$(this).attr("annotation_id"),n=$(".Annotation[annotation_id='"+t+"']");$(this).css("box-shadow","none"),n.css("box-shadow","none")}),t.find(".AnnotationDirectButton").on("click",function(t){var n=$(this).parents(".AnnotationDiv").attr("annotation_id"),e=$(".Annotation[annotation_id='"+n+"']"),o=$("#file_viewer"),a=e.offset().top-o.offset().top+o.scrollTop()-.38*window.innerHeight+e.height()/2;o.animate({scrollTop:parseInt(a)},240)}),t.find(".PostReplyReplyButton").on("click",function(){if(is_authenticated){var t=!this.classList.contains("AnonymouslyPostReplyReplyButton"),n=$(this),e=layer.load(1,{shade:.18});$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"reply_annotation",annotation_reply_content:n.parents("form").find("textarea[name='reply_reply_content']").val(),reply_to_annotation_id:n.parents(".AnnotationBlock").find(".PostAnnotationReplyButton").val(),reply_to_annotation_reply_id:n.val(),document_id:$("button[name='document_id']").val(),is_public:t},success:function(t){var o=$(t);$(".AnnotationBlock[annotation_id='"+n.parents(".AnnotationBlock").find(".PostAnnotationReplyButton").val(),NaN).append(o),$(".ReplyAnnotationButton").parents("footer").children("form").css("display","none"),tinyMCE.activeEditor.setContent(""),d(o),(0,a.tinymceInit)(),layer.close(e)}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),t.find(".DeleteAnnotationReplyButton").on("click",function(){var t=layer.load(1,{shade:.18}),n=this.value;$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"delete_annotation_reply",reply_id:n,document_id:$("button[name='document_id']").val()},success:function(e){!function(t){for(var n=$(".AnnotationReplyBlock[annotation_reply_id='"+t+"']").toArray();n.length>0;){var e=$(n.shift()),o=e.attr("annotation_reply_id");n=n.concat($(".AnnotationReplyBlock[reply_to_annotation_reply='"+o+"']").toArray()),e.remove()}}(n),layer.close(t)}})}),t.find(".PostAnnotationReplyButton").on("click",function(){if(is_authenticated){var t=!this.classList.contains("AnonymouslyPostAnnotationReplyButton"),n=$(this),e=layer.load(1,{shade:.18});$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"reply_annotation",annotation_reply_content:n.parent("form").find("textarea[name='annotation_reply_content']").val(),reply_to_annotation_id:n.val(),document_id:$("button[name='document_id']").val(),is_public:t},success:function(t){var o=$(t);$(".AnnotationBlock[annotation_id='"+n.val()+"']").append(o),$(".ReplyAnnotationButton").parents("footer").children("form").css("display","none"),tinyMCE.activeEditor.setContent(""),d(o),(0,a.tinymceInit)(),layer.close(e)}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),t.find(".DeleteAnnotationButton").on("click",function(){var t=layer.load(1,{shade:.18}),n=this.value;$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"delete_annotation",annotation_id:this.value},success:function(){i(n),layer.close(t)}})}),t.find(".LikeAnnotationButton").on("click",function(){if(is_authenticated){var t=$(this),n=parseInt(t.find(".num_like").text())+1;t.find(".num_like").text(n.toString()),t.off("click"),t.css("color","#6495ED"),t.on("click",function(){layer.msg("already liked",{icon:6,time:800})}),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"like_annotation",annotation_id:t.attr("annotation_id")}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),t.find(".LikeAnnotationReplyButton").on("click",function(){if(is_authenticated){var t=$(this),n=parseInt(t.find(".num_like").text())+1;t.find(".num_like").text(n.toString()),t.off("click"),t.css("color","#6495ED"),t.on("click",function(){layer.msg("already liked",{icon:6,time:800})}),$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,o.getCookie)("csrftoken"),operation:"like_annotation_reply",annotation_reply_id:t.attr("annotation_reply_id")}})}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),t.find(".ReplyAnnotationButton").on("click",function(){var t="none"===!$(this).css("display");$(this).parents("footer").children("form").slideToggle({duration:180,start:function(){t||$(".ReplyAnnotationButton").parents("footer").children("form").not($(this)).slideUp(180).css("display","none"),tinyMCE.get($(this).find("textarea").attr("id")).focus()}})}),t.find(".Annotation").addBack(".Annotation").on("mouseover",function(){var n=$(this).parent(".page_div").children(".PageCanvas"),e=$(this).parent(".page_div").find(".Annotation").toArray(),o=void 0;t.find(".Annotation").addBack(".Annotation").on("mousemove",function(t){if(0==t.which){var a=u(t,e,n);a!=o&&(void 0!=o&&(o.css("box-shadow","none"),$(".AnnotationBlock[annotation_id='"+$(o).attr("annotation_id")+"']").css("box-shadow","none")),a.css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)"),$(".AnnotationBlock[annotation_id='"+$(a).attr("annotation_id")+"']").css("box-shadow","3px 3px 8px rgba(0, 0, 0, .38)"),o=a)}else{var i=!0,r=!1,s=void 0;try{for(var c,l=e[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var d=c.value;$(d).css("box-shadow","none"),$(".AnnotationBlock[annotation_id='"+$(d).attr("annotation_id")+"']").css("box-shadow","none")}}catch(t){r=!0,s=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw s}}}})}),t.find(".Annotation").addBack(".Annotation").on("mouseout",function(t){if(0==t.which){var n=$(this).parent(".page_div").find(".Annotation").toArray(),e=!0,o=!1,a=void 0;try{for(var i,r=n[Symbol.iterator]();!(e=(i=r.next()).done);e=!0){var s=i.value;$(s).css("box-shadow","none"),$(".AnnotationBlock[annotation_id='"+$(s).attr("annotation_id")+"']").css("box-shadow","none"),$(s).off("mousemove")}}catch(t){o=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(o)throw a}}}})}function u(t,n,e){var o=n.filter(function(n){return function(t,n,e){var o=n.pageX-e.offset().left,a=n.pageY-e.offset().top;return r(t)<=o&&s(t)>=o&&c(t)<=a&&l(t)>=a}(n,t,e)}),a=o.sort(function(t,n){return s(t)>s(n)});return s(a[1])-s(a[0])<9&&r((a=o.sort(function(t,n){return r(t)<r(n)}))[0])-r(a[1])<9&&l((a=o.sort(function(t,n){return l(t)>l(n)}))[1])-l(a[0])<9&&(a=o.sort(function(t,n){return c(t)<c(n)})),$(a[0])}n.addAnnotationRelatedListener=function(){d($(document))},n.addAnnotationRelatedListenerWithin=d,n.scrollAnnotationDivIntoView=function(t){var n=$("#annotation_update_div"),e=t.offset().top-n.offset().top+n.scrollTop();n.animate({scrollTop:parseInt(e)},240)},n.findTargetAnnotation=u},615:function(t,n,e){"use strict";var o,a,i,r,s=e(601),c=e(600),l=e(20),d=e(599),u=e(122),f=0,p=1.08,m=1,h=[],_=[],g=!1,v=1.8;function y(t){if(m*=t,_.length>0){for(;_.length>1;)_.pop();_.push([_[0][0],"PENDING",null])}for(var n=0;n<h.length;n++){var e="page_canvas_"+h[n],o=document.getElementById(e);o.width=0,o.height=0,_.push([h[n],"PENDING",null])}h=[],g||w(_,h,m);var r=$("#file_viewer")[0].scrollHeight;a*=t,i*=t,$(".page_div").each(function(){var t=$(this);t.css("width",a+"px"),t.css("height",i+"px")}),b(t);var s=$("#file_viewer")[0].scrollHeight/r;$("#file_viewer").scrollTop(parseFloat($("#file_viewer").scrollTop())*s)}function b(t){$(".Annotation").each(function(){$(this).css("top",parseFloat($(this).css("top"))*t+"px"),$(this).css("left",parseFloat($(this).css("left"))*t+"px"),$(this).css("width",parseFloat($(this).css("width"))*t+"px"),$(this).css("height",parseFloat($(this).css("height"))*t+"px")})}function k(){var t=$("#scroll_page_into_view_div").children("input"),n=$("#scroll_page_into_view_div").children("button");t.attr("min","1"),t.attr("max",f.toString()),n.on("click",function(){var n=t.val();if(n<1||n>f)return layer.msg("Input page index out of bounds"),!1;!function(t){var n=$("#file_viewer"),e=t.offset().top-n.offset().top+n.scrollTop();n.animate({scrollTop:parseInt(e)},240)}($("#"+("page_div_"+n)))})}function x(){var t=$("#wrapper"),n=$("#file_viewer");t.css("height",document.body.clientHeight-28+"px"),t.css("width",document.body.clientWidth),n.css("height",t.height()+"px"),n.css("width",.6*parseInt(t.css("width"))+"px"),$("#annotation_update_div").css("height",t.height()+"px"),$("#annotation_update_div").css("width",t.width()-3.8-n.width()+"px"),$("#horizontal_draggable").css("height",t.height()+"px"),$(".PageImg").css("width",n.width()-24+"px"),$(".PageDiv").each(function(){var t=$(this),n=t.children(".PageImg");(0,l.imgLoad)(n[0],function(){t.css("width",n.width()+"px"),t.css("height",n.height()+"px")})})}function w(t,n,e){if(t.length>0){g=!0,$("#buttonForLarger, #buttonForSmaller").attr("disabled",!0);var a=t[0][0];o.getPage(a).then(function(o){var i="page_canvas_"+a,r=document.getElementById(i),s=r.getContext("2d"),c=o.getViewport(v*e);r.height=c.height,r.width=c.width,r.style.height=c.height/v+"px",r.style.width=c.width/v+"px";var l={canvasContext:s,viewport:c};t[0][2]=o.render(l),t[0][1]="RENDERING",t[0][2].promise.then(function(){t.shift(),n.push(a),g=!1,$("#buttonForLarger, #buttonForSmaller").attr("disabled",!1),w(t,n,e)},function(t){console.log("rejected because of this reason: "+t)})})}}$(document).ready(function(){!function(t){PDFJS.workerSrc="/static/pdfjs/pdf.worker.js";var n=layer.load(1,{shade:!1,offset:"48%"});PDFJS.getDocument(t).then(function(t){layer.close(n),f=(o=t).numPages,k(),o.getPage(f).then(function(t){m=.66*$("#file_viewer").width()/t.getViewport(1).width;var n="";i=t.getViewport(m).height,a=t.getViewport(m).width;for(var e=1;e<=o.numPages;e++){var c="page_div_"+e,d="page_canvas_"+e,p="<div class='page_div' id='"+c+"'><canvas class='PageCanvas' id='"+d+"'></canvas></div><br>";n+=p}$("#file_viewer").append(n),$(".page_div").css("height",i+"px"),$(".page_div").css("width",a+"px"),function(){var t="rgba(0,0,0,0.18)";r.on("change",function(n){var e=(0,l.hexToRgb)(n);t="rgba("+e.r+","+e.g+","+e.b+",0.18)"}),$("#annotation_color_buttons_div").find(".ColorSelectorButton").on("click",function(){t=$(this).css("background-color")}),$(".PageDiv, .page_div").on("mousedown",function(n){if(!$(n.target).hasClass("ui-draggable")&&!$(n.target).hasClass("ui-resizable-handle")){layer.closeAll(),$(".ui-draggable.Annotation").remove();var e=$(this).find(".PageImg, .PageCanvas"),o=n.pageX,a=n.pageY,i=o-e.offset().left,r=a-e.offset().top,c=$("<div class='Annotation'></div>");e.parents(".page_div, .PageDiv").append(c),c.css({background:t,position:"absolute",width:"1px",height:"1px",left:i,top:r}),$(".PageImg, .PageCanvas, .Annotation").on("mousemove",function(t){var n=t.pageX,o=t.pageY,a=n-e.offset().left,s=o-e.offset().top;c.css({width:Math.abs(a-i),height:Math.abs(s-r),left:Math.min(i,a),top:Math.min(r,s)}),t.stopPropagation()}),$("body").on("mouseup",function(n){if($(n.target).hasClass("PageImg")||$(n.target).hasClass("PageCanvas")||$(n.target).hasClass("Annotation")){var o=e.height(),a=e.width(),i=parseFloat(c.css("top"))/o,r=parseFloat(c.css("left"))/a,d=parseFloat(c.css("height"))/o,f=parseFloat(c.css("width"))/a;if(i+d>1||r+f>1)return c.remove(),$(".PageImg, .PageCanvas, .Annotation").off("mousemove"),$("body").off("mouseup"),void n.stopPropagation();if(d<.008&&f<.008){var p=c.parent(".page_div");c.remove();var m=p.find(".Annotation").toArray(),h=(0,s.findTargetAnnotation)(n,m,p);return void 0!=h[0]&&(0,s.scrollAnnotationDivIntoView)($(".AnnotationDiv[annotation_id='"+h.attr("annotation_id")+"']")),$(".PageImg, .PageCanvas, .Annotation").off("mousemove"),$("body").off("mouseup"),void n.stopPropagation()}c.draggable({containment:"parent"}).resizable({containment:"parent"});var _=layer.open({type:1,title:"Post Annotation",shadeClose:!0,shade:!1,maxmin:!0,zIndex:800,fixed:!1,content:'<form id="annotation_form">                        <textarea name="annotation_content" class="form-control" rows="8" style="resize: vertical"></textarea>                        <button type="button" class="post_annotation_button anonymously_post_annotation_button btn" name="document_id" value="{{ document.id }}" style="margin: 8px; float: right; border-radius: 0; color: white; background-color: #636e72">                          <i class="fa fa-user-secret"></i> &nbsp post anonymously                        </button>                        <button type="button" class="post_annotation_button btn " name="document_id" value="{{ document.id }}" style="margin: 8px; float: right; border-radius: 0; color: white; background-color: #1BA39C">post annotation</button>                    </form>',success:function(){(0,u.tinymceInit)()},cancel:function(){c.remove()}}),g=$(".layui-layer[times="+_+"]");g.find(".post_annotation_button").on("click",function(){if(is_authenticated){var n=!this.classList.contains("anonymously_post_annotation_button");$.ajax({type:"POST",url:"",data:{csrfmiddlewaretoken:(0,l.getCookie)("csrftoken"),operation:"annotate",annotation_content:g.find("textarea[name='annotation_content']").val(),page_id:e.attr("id"),top_percent:i,left_percent:r,height_percent:d,width_percent:f,frame_color:t,document_id:$("button[name='document_id']").val(),is_public:n},success:function(t){c.draggable("destroy").resizable("destroy");var n=$(t.new_annotationdiv_html),e=$($(".AnnotationDiv").toArray().find(function(t){return parseInt(t.getAttribute("page"))>=parseInt(n.attr("page"))}));void 0==e[0]?$("#annotation_update_div").append(n):n.insertBefore(e),(0,s.addAnnotationRelatedListenerWithin)(n),(0,s.addAnnotationRelatedListenerWithin)(c),(0,u.tinymceInit)(),c.attr("annotation_id",t.new_annotation_id),layer.close(_)}}),g.find(".post_annotation_button").attr("disabled",!0)}else layer.msg('You need to <a href="/sign-in" style="color: #ECECEC; text-decoration: underline">log in</a> first')}),$(".PageImg, .PageCanvas, .Annotation").off("mousemove"),$("body").off("mouseup"),g.find(".post_annotation_button").attr("disabled",!1)}else c.remove(),$(".PageImg, .PageCanvas, .Annotation").off("mousemove"),$("body").off("mouseup");n.stopPropagation()}),n.stopPropagation()}})}(),drawAllExistingAnnotationFrame(),(0,s.addAnnotationRelatedListener)(),_.push([Math.min(f,1),"PENDING",null]),_.push([Math.min(f,2),"PENDING",null]),_.push([Math.min(f,3),"PENDING",null]),_.push([Math.min(f,4),"PENDING",null]),_.push([Math.min(f,5),"PENDING",null]),w(_,h,m),function(){var t=1;$("#file_viewer").scroll(function(){var n=this.scrollTop/this.scrollHeight,e=Math.ceil(n*f);if(e!=t){t=e;for(var o=[!0,!0,!0,!0,!0],a=0,i=h.length,r=0;r<i;r++)if(h[a]-e>=-1&&h[a]-e<=3)o[h[a]-e+1]=!1,a+=1;else{var s="page_canvas_"+h[a],c=document.getElementById(s);c.width=0,c.height=0,h.splice(a,1)}for(;_.length>1;)_.pop();for(var r=0;r<5;r++)1==o[r]&&_.push([Math.min(f,Math.max(1,e+r-1)),"PENDING",null]);g||w(_,h,m)}})}()})})}($("#file-url").val()),(0,u.tinymceInit)(),(0,c.enablePostCommentButton)(),(0,c.enableRefreshCommentButton)(),$("#buttonForLarger").on("click",function(){y(p)}),$("#buttonForSmaller").on("click",function(){y(1/p)}),(0,d.prepareNavbarFunction)(),$(window).resize(function(){x();var t=parseFloat($(".PageImg").css("width"));b(parseFloat($(".PageImg").css("width"))/t)}),r=new Huebee(".color-picker",{notation:"hex",saturations:2}),(0,c.addCommentRelatedListener)(),x();var t=$("#wrapper"),n=$("#file_viewer");$("#horizontal_draggable").draggable({axis:"x",containment:"#containment-wrapper",revert:!0,revertDuration:0,stop:function(e,o){var a=o.offset.left;n.css("width",a+"px"),$("#annotation_update_div").css("width",t.width()-3-n.width()+"px")}})})}});