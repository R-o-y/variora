{% for annotation in annotations %}
<div class="AnnotationDiv" annotation_id="{{ annotation.id }}">
<hr>
<blockquote class="AnnotationBlock" annotation_id="{{ annotation.id }}">
    <!-- annotation -->
    <div class="annotation-content"> {{ annotation.content|safe|linebreaks }} </div>
    <footer>
        <img class="img-rounded" src="{{ annotation.annotator.portrait_url }}" height="38" width="38">
        {{ annotation.annotator.nickname }} | {{ annotation.post_time.date|date:"Y. M. d" }}
        <div style="float: right;">
            <button class="ReplyAnnotationButton btn" style="border: none; background: none"><i class="fa fa-reply" aria-hidden="true"></i>&nbspreply</button>
            {% if annotation.annotator == request.user %}
                <button style="border: none; background: none" class="DeleteAnnotationButton btn" value="{{ annotation.id }}"><i class="fa fa-trash-o" aria-hidden="true"></i>&nbspdelete</button>
            {% endif %}
            <div class="btn">
                <span style="cursor: pointer;" annotation_id="{{ annotation.id }}" class="LikeAnnotationButton glyphicon glyphicon-thumbs-up"></span>
                <bold id="num_like">{{ annotation.num_like }}</bold>
            </div>
        </div>
        <form style="display: none">
            <br>
            <textarea name="annotation_reply_content" class="form-control" rows="2" style="resize: vertical"></textarea>
            <button type="button" class="PostAnnotationReplyButton btn btn-sm" name="annotation_id" value="{{ annotation.id }}"> reply</button>
        </form>
    </footer>
    <br>
    <!-- annotation replies -->
    {% for annotation_reply in annotation.annotationreply_set.all|dictsort:"post_time" %}
    <blockquote class="AnnotationReplyBlock" annotation_id="{{ annotation_reply.id }}">
        {% if annotation_reply.reply_to_annotation_reply.replier %}  <!-- if reply to reply -->
        <span style="font-size: 66%; float: left;">
            <i class="fa fa-share" aria-hidden="true"></i>&nbsp&nbsp&nbspreply to <i><b>{{ annotation_reply.reply_to_annotation_reply.replier.nickname }}</b></i>:
        </span><br>
        {% endif %}
        <div class="annotation-content"> {{ annotation_reply.content|safe|linebreaks }} </div>
        <footer>
            <img class="img-rounded" src="{{ annotation_reply.replier.portrait_url }}" height="28" width="28">
            {{ annotation_reply.replier.nickname }} | {{ annotation_reply.post_time.date|date:"Y. M. d" }}
            <div style="float: right;">
                <button class="ReplyAnnotationButton btn" style="border: none; background: none; padding: 0 4px"><i class="fa fa-reply" aria-hidden="true"></i>&nbspreply</button>
                {% if annotation_reply.replier == request.user %}
                    <button class="DeleteAnnotationReplyButton btn" style="border: none; background: none; padding: 0 4px" value="{{ annotation_reply.id }}"><i class="fa fa-trash-o" aria-hidden="true"></i>&nbspdelete</button>
                {% endif %}
                <div class="btn" style="padding: 0 4px">
                    <span style="cursor: pointer;" annotation_reply_id="{{ annotation_reply.id }}" class="LikeAnnotationReplyButton glyphicon glyphicon-thumbs-up"></span>
                    <bold id="num_like">{{ annotation_reply.num_like }}</bold>
                </div>
            </div>   
            <form style="display: none">
                <br>
                <textarea name="reply_reply_content" class="form-control" rows="2" style="resize: vertical"></textarea>
                <button type="button" class="PostReplyReplyButton btn btn-sm" name="reply_to_annotation_reply_id" value="{{ annotation_reply.id }}">reply</button>
            </form>
        </footer>
    </blockquote>
    {% endfor %}
</blockquote>
</div>
{% endfor %}








