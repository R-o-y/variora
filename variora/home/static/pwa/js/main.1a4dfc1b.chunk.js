(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{132:function(e,t,n){e.exports=n.p+"static/media/logo.1f3294f6.svg"},230:function(e,t,n){},286:function(e,t,n){e.exports=n(621)},287:function(e,t,n){},292:function(e,t,n){},579:function(e,t,n){},608:function(e,t,n){},621:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"getUser",function(){return re}),n.d(a,"getMyDocuments",function(){return oe}),n.d(a,"uploadDocument",function(){return ie}),n.d(a,"uploadCoterieDocument",function(){return le}),n.d(a,"renameDocument",function(){return se}),n.d(a,"deleteDocument",function(){return ce}),n.d(a,"deleteDocumentSuccess",function(){return ue}),n.d(a,"uncollectDocument",function(){return de}),n.d(a,"uncollectDocumentSuccess",function(){return pe}),n.d(a,"getMyReadlists",function(){return me}),n.d(a,"getReadlist",function(){return he}),n.d(a,"deleteReadlist",function(){return fe}),n.d(a,"deleteReadlistSuccess",function(){return ge}),n.d(a,"getExploreDocuments",function(){return ye}),n.d(a,"getExploreReadlists",function(){return ve}),n.d(a,"getCombinedNotifications",function(){return Ee}),n.d(a,"markNotificationAsRead",function(){return ke}),n.d(a,"getMyCoteries",function(){return be}),n.d(a,"getMyCoteriesDocument",function(){return Ce}),n.d(a,"getMyCoteriesReadlists",function(){return we}),n.d(a,"createReadlist",function(){return xe}),n.d(a,"editReadlist",function(){return Ae}),n.d(a,"collectReadlist",function(){return _e}),n.d(a,"collectReadlistSuccess",function(){return Se}),n.d(a,"uncollectReadlist",function(){return Oe}),n.d(a,"uncollectReadlistSuccess",function(){return je}),n.d(a,"documentChangeReadlists",function(){return De}),n.d(a,"removeFromReadlistSuccess",function(){return Ie}),n.d(a,"createCoterie",function(){return Re}),n.d(a,"updateCoterie",function(){return Me}),n.d(a,"updateCoterieSuccess",function(){return Te}),n.d(a,"leaveCoterie",function(){return Be}),n.d(a,"deleteCoterie",function(){return Le}),n.d(a,"getSearchResults",function(){return Pe}),n.d(a,"getCoterieSearchResults",function(){return Fe}),n.d(a,"inviteToCoterie",function(){return Ne}),n.d(a,"removeMember",function(){return Ue}),n.d(a,"getInvitations",function(){return ze}),n.d(a,"acceptInvitation",function(){return He}),n.d(a,"declineInvitation",function(){return Ye});n(287),n(143),n(290),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var r=n(627),o=n(628),i=n(629),l=n(626),s=n(73),c=n(16),u=n(17),d=n(20),p=n(18),m=n(19),h=(n(292),n(294),n(0)),f=n.n(h),g=n(4),y=n.n(g),v=n(23),E=n(13),k=n.n(E),b="user_get",C="document_get_my",w="document_get_my_documents",x="document_get_explore",A="document_upload",_="document_rename",S="document_delete_success",O="document_uncollect_success",j="readlist_get_my",D="readlist_get_explore",I="readlist_get",R="readlist_create",M="readlist_edit",T="readlist_delete_success",B="readlist_collect_success",L="readlist_uncollect_success",P="readlist_remove_document_success",F="notification_get_combined",N="notification_read",U="search_result_get",z="search_error",H="coterie_get_my",Y="coterie_create",W="coterie_update",G="coterie_update_success",V="coterie_invite",X="coterie_member_delete",J="coterie_document_upload",K="coterie_leave",q="coterie_delete",Q="invitation_get",$="invitation_accept",Z="invitation_decline",ee="/file_viewer/api/documents/upload",te="/coterie/api/coteriedocuments/upload",ne="/coterie/api/invite",ae="/coterie/api/invitations";function re(){var e=k.a.get("/api/user");return{type:b,payload:e}}function oe(){var e=k.a.get("/file_viewer/api/documents");return{type:C,payload:e}}function ie(e){var t=k()({method:"post",headers:{"Content-Type":"multipart/form-data"},url:ee,data:e});return{type:A,payload:t}}function le(e){var t=k()({method:"post",headers:{"Content-Type":"multipart/form-data"},url:te,data:e});return{type:J,payload:t}}function se(e,t){var n=k()({method:"post",url:e,data:t});return{type:_,payload:n}}function ce(e,t,n){return function(a){return k()({method:"post",url:e,data:t}).then(function(){a(ue(n))}).catch(function(e){throw e})}}function ue(e){return{type:S,payload:e}}function de(e,t,n){return function(a){return k()({method:"post",url:e,data:t}).then(function(){a(pe(n))}).catch(function(e){throw e})}}function pe(e){return{type:O,payload:e}}function me(){var e=k.a.get("/file_viewer/api/readlists");return{type:j,payload:e}}function he(e){var t="/file_viewer/api/readlists/"+e,n=k.a.get(t);return{type:I,payload:n}}function fe(e,t,n){return function(a){return k()({method:"post",url:e,data:t}).then(function(){a(ue(n))}).catch(function(e){throw e})}}function ge(e){return{type:T,payload:e}}function ye(){var e=k.a.get("/file_viewer/api/documents/explore");return{type:x,payload:e}}function ve(){var e=k.a.get("/file_viewer/api/readlists/explore");return{type:D,payload:e}}function Ee(){var e=k.a.get("/notifications/api/combined");return{type:F,payload:e}}function ke(e,t){var n=k.a.get(e);return{type:N,payload:n,slug:t}}function be(){var e=k.a.get("/coterie/api/coteries");return{type:H,payload:e}}function Ce(e){var t="/coteries/api/coteries/".concat(e,"/members/me/uploaded-documents"),n=k.a.get(t);return{type:w,payload:n}}function we(e){}function xe(e){var t=k()({method:"post",url:"/file_viewer/api/readlists/create",data:e});return{type:R,payload:t}}function Ae(e,t){var n=k()({method:"post",url:e,data:t});return{type:M,payload:n}}function _e(e,t){var n="/file_viewer/api/readlists/"+t+"/collect";return function(a){return k()({method:"post",url:n,data:e}).then(function(){a(Se(t))}).catch(function(e){throw e})}}function Se(e){return{type:B,payload:e}}function Oe(e,t){var n="/file_viewer/api/readlists/"+t+"/uncollect";return function(a){return k()({method:"post",url:n,data:e}).then(function(){a(je(t))}).catch(function(e){throw e})}}function je(e){return{type:L,payload:e}}function De(e,t){var n="/file_viewer/api/documents/"+e+"/changereadlists";return console.log("making req to "+n+" with data"),console.log(t),function(e){return k()({method:"post",url:n,data:t}).then(function(){e(Ie())}).catch(function(e){throw e})}}function Ie(){return{type:P,payload:{}}}function Re(e){var t=k()({method:"post",url:"/coterie/api/coteries/create",data:e});return{type:Y,payload:t}}function Me(e,t){var n="/coterie/api/coteries/".concat(t,"/update"),a=k()({method:"post",url:n,data:e});return{type:W,payload:a}}function Te(e,t,n){return{type:G,payload:{uuid:e,name:t,description:n}}}function Be(e,t,n){var a="/coterie/api/coteries/".concat(t,"/exit"),r=k()({method:"post",url:a,data:e});return{type:K,payload:r,uuid:n}}function Le(e,t,n){var a="/coterie/api/coteries/".concat(t,"/delete"),r=k()({method:"post",url:a,data:e});return{type:q,payload:r,uuid:n}}function Pe(e){var t="/api/search?key="+e;return function(e){k.a.get(t).then(function(t){e({type:U,payload:t})}).catch(function(t){e({type:z})})}}function Fe(e,t){var n="/coterie/api/coteries/"+t+"/search?key="+e;return function(e){k.a.get(n).then(function(t){e({type:U,payload:t})}).catch(function(t){e({type:z})})}}function Ne(e){var t=k()({method:"post",url:ne,data:e});return{type:V,payload:t}}function Ue(e,t,n,a){return function(r){return k()({method:"post",url:e,data:t}).then(function(e){r({type:X,payload:{uuid:n,email:a}})}).catch(function(e){throw e})}}function ze(){var e=k.a.get(ae);return{type:Q,payload:e}}function He(e,t,n){var a=k()({method:"post",url:e,data:t});return{type:$,payload:a,pk:n}}function Ye(e,t,n){var a=k()({method:"post",url:e,data:t});return{type:Z,payload:a,pk:n}}n(326);var We=n(79),Ge=n.n(We),Ve=n(183),Xe=n.n(Ve),Je=n(184),Ke=n.n(Je),qe=n(185),Qe=n.n(qe),$e=n(250),Ze=n.n($e),et=n(251),tt=n.n(et),nt=n(186),at=n.n(nt),rt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={selectedTab:n.props.path.split("/").pop(),hidden:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"getGroupPath",value:function(){var e=this.props.path,t=e.split("/").slice(1);return t.length>=1&&"groups"===t[0]?e.split("/").slice(0,-1).join("/"):""}},{key:"render",value:function(){var e=this;return f.a.createElement("div",{style:{position:"fixed",height:"100%",width:"100%",top:0}},f.a.createElement(Ge.a,{unselectedTintColor:"#949494",tintColor:"#1BA39C",barTintColor:"white",hidden:this.state.hidden},f.a.createElement(Ge.a.Item,{icon:f.a.createElement(Xe.a,null),selectedIcon:f.a.createElement(Xe.a,null),title:"explore"===this.state.selectedTab?"explore":"",key:"explore",selected:"explore"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"explore"}),e.props.history.push("".concat(e.getGroupPath(),"/explore"))}},"explore"===this.state.selectedTab&&this.props.content),f.a.createElement(Ge.a.Item,{icon:f.a.createElement(Ke.a,null),selectedIcon:f.a.createElement(Ke.a,null),title:"uploads"===this.state.selectedTab?"uploads":"",key:"Uploads",selected:"uploads"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"uploads"}),e.props.history.push("".concat(e.getGroupPath(),"/uploads"))}},"uploads"===this.state.selectedTab&&this.props.content),f.a.createElement(Ge.a.Item,{icon:f.a.createElement(Qe.a,null),selectedIcon:f.a.createElement(Qe.a,null),title:"readlists"===this.state.selectedTab?"readlists":"",key:"Readlists",selected:"readlists"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"readlists"}),e.props.history.push("".concat(e.getGroupPath(),"/readlists"))}},"readlists"===this.state.selectedTab&&this.props.content),f.a.createElement(Ge.a.Item,{icon:f.a.createElement(Ze.a,null),selectedIcon:f.a.createElement(tt.a,null),title:"notifications"===this.state.selectedTab?"notifications":"",key:"Notifications",selected:"notifications"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"notifications"}),e.props.history.push("".concat(e.getGroupPath(),"/notifications"))}},"notifications"===this.state.selectedTab&&this.props.content),f.a.createElement(Ge.a.Item,{icon:f.a.createElement(at.a,null),selectedIcon:f.a.createElement(at.a,null),title:"settings"===this.state.selectedTab?"settings":"",key:"Settings",selected:"settings"===this.state.selectedTab,onPress:function(){e.setState({selectedTab:"settings"}),e.props.history.push("".concat(e.getGroupPath(),"/settings"))}},"settings"===this.state.selectedTab&&this.props.content)))}}]),t}(f.a.Component),ot=(n(48),n(3)),it=n.n(ot),lt=(n(62),n(15)),st=n.n(lt),ct=(n(98),n(54)),ut=n.n(ct),dt=n(71),pt=n(60),mt=n.n(pt),ht=n(72),ft=(n(230),n(65),n(40)),gt=n.n(ft),yt=(n(87),n(53)),vt=n.n(yt),Et=(n(52),n(31)),kt=n.n(Et),bt=(n(88),n(34)),Ct=n.n(bt),wt=n(33),xt=n(37),At=n(42),_t=n(46),St=n.n(_t),Ot=n(38),jt=n(107),Dt=n.n(jt),It=n(253),Rt=n.n(It),Mt=n(63);Mt.b.add(xt.l,xt.k,xt.j);var Tt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={coterieModal:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"showModal",value:function(e,t){t.preventDefault(),this.setState(Object(wt.a)({},e,!0))}},{key:"onClose",value:function(e){this.setState(Object(wt.a)({},e,!1))}},{key:"getRandomColor",value:function(e){return["#1BA39C","#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#f1c40f","#e67e22","#e74c3c"][e.charCodeAt(0)%8]}},{key:"goToGroup",value:function(e){var t=this.props.history.location.pathname.split("/").pop();this.props.history.push("/groups/".concat(e,"/").concat(t))}},{key:"renderCoterieItem",value:function(e){var t=this,n=this.props.coteries[e];return f.a.createElement(it.a.Item,{key:n.pk,extra:n.members.length+" members",align:"top",onClick:function(){return Ct.a.alert("Switch to group "+n.name+"?","",[{text:"Cancel"},{text:"OK",style:{color:"#1BA39C"},onPress:function(){t.goToGroup(n.uuid),t.onClose("coterieModal")}}])}},n.name,f.a.createElement(it.a.Item.Brief,null,n.description))}},{key:"render",value:function(){var e=this,t=!y.a.isEmpty(this.props.user.administratedCoteries),n=!y.a.isEmpty(this.props.user.joinedCoteries);return console.log(this.props),f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",style:{boxShadow:"0px 1px 3px rgba(28, 28, 28, .1)",zIndex:1e7,position:"relative",paddingRight:8},leftContent:f.a.createElement(St.a,{alt:"avatar",style:{width:28,height:28},src:this.props.user.portrait_url,onClick:function(t){console.log("User avatar clicked"),e.props.history.push("/profile")}}),rightContent:[f.a.createElement(kt.a,{key:"0",type:"search",style:{marginRight:"16px"},onClick:function(t){e.props.match.params.groupUuid?e.props.history.push("/search/"+e.props.match.params.groupUuid):e.props.history.push("/search")}}),f.a.createElement("div",{key:"1"},this.props.match.params.groupUuid?f.a.createElement(Rt.a,{color:"primary",classes:{badge:this.props.classes.badge},badgeContent:f.a.createElement(St.a,{className:this.props.classes.avatar,style:{backgroundColor:this.getRandomColor(this.props.match.params.groupUuid)}},f.a.createElement("span",{style:{fontSize:"80%"}},this.props.coteries[this.props.match.params.groupUuid].name.charAt(0)))},f.a.createElement(Dt.a,{style:{color:"rgb(101, 119, 134)",height:25,width:25},onClick:function(t){e.props.getMyCoteries(),e.showModal("coterieModal",t)}})):f.a.createElement(Dt.a,{style:{color:"rgb(101, 119, 134)",height:25,width:25},onClick:function(t){e.props.getMyCoteries(),e.showModal("coterieModal",t)}}),f.a.createElement(Ct.a,{popup:!0,visible:this.state.coterieModal,onClose:function(){return e.onClose("coterieModal")},animationType:"slide-up",style:{overflow:"auto",maxHeight:"80vh"}},f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",{style:{color:"#1BA39C"}},"SWITCH GROUP")},className:"popup-list"},f.a.createElement(it.a.Item,{onClick:function(){var t=e.props.history.location.pathname.split("/").pop();Ct.a.alert("Switch to public?","This is where everyone is in.",[{text:"Cancel"},{text:"OK",style:{color:"#1BA39C"},onPress:function(){e.props.history.push("/".concat(t)),e.onClose("coterieModal")}}])}},"Public"),!n&&!t&&f.a.createElement("div",null,"You have not joined any groups."),t&&f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",null,"Administrated")}},this.props.user.administratedCoteries.map(function(t){return e.renderCoterieItem(t)})),n&&f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",null,"Joined")}},this.props.user.joinedCoteries.map(function(t){return e.renderCoterieItem(t)})),f.a.createElement(it.a.Item,null,f.a.createElement(vt.a,{type:"primary",style:{backgroundColor:"#1BA39C"},onClick:function(){e.onClose("coterieModal"),e.props.history.push("/create-coterie-form")}},"Create a new group")))))]},this.props.title))}}]),t}(h.Component);var Bt=Object(v.b)(function(e){return{user:e.user,coteries:e.coteries}},a)(Object(At.withStyles)(function(e){return{badge:{top:6,right:-16,border:"1px solid white"},avatar:{width:"100%",height:"100%"}}})(Tt)),Lt=n(41),Pt=n.n(Lt),Ft=n(58),Nt=n.n(Ft),Ut=n(44),zt=n.n(Ut),Ht=n(181),Yt=n.n(Ht),Wt=n(179),Gt=n.n(Wt),Vt=n(180),Xt=n.n(Vt),Jt=n(47),Kt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;(function(){var t=Object(ht.a)(mt.a.mark(function t(){return mt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.props.getExploreDocuments();case 3:return t.next=5,e.props.getExploreReadlists();case 5:t.next=11;break;case 7:return t.prev=7,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return");case 11:e.setState({loading:!1});case 12:case"end":return t.stop()}},t,this,[[0,7]])}));return function(){return t.apply(this,arguments)}})()()}},{key:"renderReactSticky",value:function(e){return f.a.createElement(Jt.Sticky,null,function(t){var n=t.style;return f.a.createElement("div",{style:Object(dt.a)({},n,{zIndex:1})},f.a.createElement(ut.a.DefaultTabBar,e))})}},{key:"renderDocumentsSubgrid",value:function(e,t){var n=this;if(!e.length)return f.a.createElement("div",null);var a=e.map(function(e){return f.a.createElement("div",{key:e.open_url},f.a.createElement(Gt.a,{className:"grid-tile",key:e.open_url,onClick:function(){n.props.history.push("".concat(e.open_url))}},f.a.createElement(zt.a,{container:!0,alignItems:"center",style:{height:"100%"}},f.a.createElement("img",{src:e.image,alt:e.title})),f.a.createElement(Xt.a,{style:{height:"25%"},title:f.a.createElement("div",{style:{fontSize:"0.8rem",fontWeight:"bold"}},e.title),subtitle:f.a.createElement("div",{style:{fontSize:"0.7rem"}},f.a.createElement(Nt.a,{date:e.upload_time}))})))});return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement("div",{style:{color:"#888",fontSize:"14px"}},t),f.a.createElement(st.a,null),f.a.createElement(Yt.a,{cellSpacing:0,cols:1,cellHeight:"auto",style:{flexWrap:"nowrap",margin:0}},a))}},{key:"renderReadlistsSublist",value:function(e,t){var n=this;if(!e.length)return f.a.createElement("div",null);var a=e.map(function(e){return f.a.createElement(it.a.Item,{key:e.slug,extra:f.a.createElement(Nt.a,{date:e.create_time}),thumb:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678072-folder-document-512.png",multipleLine:!0,onClick:function(){n.props.history.push("".concat(e.url))}},e.name,f.a.createElement(it.a.Item.Brief,null,e.owner.nickname))});return f.a.createElement("div",null,f.a.createElement(it.a,{renderHeader:function(){return t}},a))}},{key:"renderExploreDocuments",value:function(){var e=this.props.explore.documents;return f.a.createElement("div",null,this.renderDocumentsSubgrid(e.mostViewsDocuments,"Most Views"),this.renderDocumentsSubgrid(e.mostStarsDocuments,"Most Stars"),this.renderDocumentsSubgrid(e.mostAnnotationsDocuments,"Most Annotations"))}},{key:"renderExploreReadlists",value:function(){var e=this.props.explore.readlists;return f.a.createElement("div",null,this.renderReadlistsSublist(e.mostCollectorsReadlists,"Trending Lists"),this.renderReadlistsSublist(e.newestReadlists,"Recent Lists"))}},{key:"renderStickyTab",value:function(){return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(Jt.StickyContainer,null,f.a.createElement(ut.a,{tabs:[{title:"Documents"},{title:"Readlists"}],initalPage:"t2",swipeable:!1,_renderTabBar:this.renderReactSticky},f.a.createElement("div",{style:{justifyContent:"center",height:"100%"}},this.renderExploreDocuments()),f.a.createElement("div",{style:{justifyContent:"center",height:"100%"}},this.renderExploreReadlists()))),f.a.createElement(st.a,null))}},{key:"render",value:function(){return this.state.loading?f.a.createElement("div",null,f.a.createElement(Bt,{title:"Explore",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5})):f.a.createElement("div",null,f.a.createElement(Bt,{title:"Explore",history:this.props.history,match:this.props.match}),this.renderStickyTab())}}]),t}(h.Component);var qt=Object(v.b)(function(e){return{user:e.user,explore:e.explore}},a)(Kt),Qt=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getMyCoteries().then(function(){e.setState({loading:!1})})}},{key:"renderReactSticky",value:function(e){return f.a.createElement(Jt.Sticky,null,function(t){var n=t.style;return f.a.createElement("div",{style:Object(dt.a)({},n,{zIndex:1})},f.a.createElement(ut.a.DefaultTabBar,e))})}},{key:"renderCoterieDocuments",value:function(){var e=this,t=this.props.coteries[this.props.match.params.groupUuid].coteriedocument_set.map(function(t){return f.a.createElement(it.a.Item,{key:t.slug,extra:f.a.createElement(Nt.a,{date:t.upload_time}),thumb:"https://cdn1.iconfinder.com/data/icons/file-types-23/48/PDF-128.png",multipleLine:!0,onClick:function(){e.props.history.push("/group-documents/".concat(t.slug))}},t.title,f.a.createElement(it.a.Item.Brief,null,t.uploader_name))}).reverse();return f.a.createElement(it.a,null,t)}},{key:"renderCoterieReadlists",value:function(){return f.a.createElement(it.a,null,f.a.createElement(it.a.Item,null,f.a.createElement("div",{style:{color:"grey",textAlign:"center"}},"Group-based readlists still in development.")))}},{key:"renderStickyTab",value:function(){return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(Jt.StickyContainer,null,f.a.createElement(ut.a,{tabs:[{title:"Documents"},{title:"Readlists"}],initalPage:"t2",swipeable:!1,_renderTabBar:this.renderReactSticky},f.a.createElement("div",{style:{justifyContent:"center",height:"100%"}},this.renderCoterieDocuments()),f.a.createElement("div",{style:{justifyContent:"center",height:"100%"}},this.renderCoterieReadlists()))),f.a.createElement(st.a,null))}},{key:"render",value:function(){if(this.state.loading)return f.a.createElement("div",null,f.a.createElement(Bt,{title:"",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5}));var e=this.props.coteries[this.props.match.params.groupUuid].name;return f.a.createElement("div",null,f.a.createElement(Bt,{title:e,history:this.props.history,match:this.props.match}),this.renderStickyTab())}}]),t}(h.Component);var $t=Object(v.b)(function(e){return{user:e.user,explore:e.explore,coteries:e.coteries}},a)(Qt),Zt=(n(126),n(39)),en=n.n(Zt),tn=n(50),nn=n.n(tn),an=n(95),rn=n.n(an),on=n(255),ln=n.n(on),sn=n(92),cn=n.n(sn),un=n(135),dn=n.n(un);function pn(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var r=n[a].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}function mn(e){var t=document.createElement("input");t.style.hidden=!0,document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}var hn=5242880;var fn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={uploadedActionModal:!1,collectedActionModal:!1,selectedDocument:null,loading:!0},n.handleFiles=function(){var e=n.finput.files[0];if("application/pdf"===e.type){var t=n.props.user;if((void 0===t||!t.is_superuser)&&!function(e){return!(e.size>hn)||(en.a.info("Document size should be less than 5 MB",1),!1)}(e))return!1;var a=e.name.split(".").slice(0,-1).join(".");if(a.includes("."))en.a.fail("Special characters are not allowed in file name",2.8);else{var r=new FormData;if(r.append("title",a),r.append("file_upload",e),r.append("csrfmiddlewaretoken",pn("csrftoken")),n.setState({uploading:!0}),en.a.loading("Loading..."),n.props.match.params.groupUuid){var o=n.props.coteries[n.props.match.params.groupUuid].pk;r.append("coterie_pk",o),n.props.uploadCoterieDocument(r).then(function(){en.a.success("Upload success!",1),n.setState({uploading:!1})}).catch(function(e){en.a.fail("Upload failed!",1)})}else n.props.uploadDocument(r).then(function(){en.a.success("Upload success!",1),n.setState({uploading:!1})}).catch(function(e){en.a.fail("Upload failed!",1)});n.finput.value=""}}else en.a.fail("File type is not PDF",1.8)},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.groupUuid;t?this.props.getMyCoteriesDocument(t).then(function(){e.setState({loading:!1})}):this.props.getMyDocuments().then(function(){e.setState({loading:!1})})}},{key:"componentDidUpdate",value:function(e){var t=this.props.match.params.groupUuid;t!==e.match.params.groupUuid&&(t?this.props.getMyCoteriesDocument(t):this.props.getMyDocuments())}},{key:"showModal",value:function(e,t){t.preventDefault(),this.setState(Object(wt.a)({},e,!0))}},{key:"onClose",value:function(e){this.setState(Object(wt.a)({},e,!1))}},{key:"renderReactSticky",value:function(e){return f.a.createElement(Jt.Sticky,null,function(t){var n=t.style;return f.a.createElement("div",{style:Object(dt.a)({},n,{zIndex:1})},f.a.createElement(ut.a.DefaultTabBar,e))})}},{key:"renderListItem",value:function(e,t){var n=this;return f.a.createElement("div",{key:e.slug},f.a.createElement(it.a.Item,{thumb:f.a.createElement("img",{src:"https://cdn1.iconfinder.com/data/icons/file-types-23/48/PDF-128.png",alt:"pdf-icon",style:{height:28,width:28}}),multipleLine:!0,onClick:function(){var t=n.props.match.params.groupUuid;if(t){var a=n.props.coteries[t].pk;n.props.history.push("/coteries/".concat(a,"/documents/").concat(e.slug))}else n.props.history.push("/documents/".concat(e.slug))}},f.a.createElement("div",{style:{width:"88%",overflow:"hidden",textOverflow:"ellipsis"}},e.title),f.a.createElement(it.a.Item.Brief,null,nn()(e.upload_time).format("MMMM Do YYYY, h:mm a"))),f.a.createElement(kt.a,{type:"ellipsis",style:{position:"absolute",width:"10%",marginTop:-50,right:5,color:"#a8a8a8",zIndex:1},onClick:function(a){n.setState({selectedDocument:e.slug}),n.showModal(t?"uploadedActionModal":"collectedActionModal",a)}}))}},{key:"renderAddDocument",value:function(){var e=this;return f.a.createElement(it.a.Item,{thumb:f.a.createElement(rn.a,{style:{color:"grey"}}),onClick:function(){return e.finput.click()}},f.a.createElement("div",{style:{color:"grey"}},"New document"),f.a.createElement(it.a.Item.Brief,null,"Click to upload..."))}},{key:"renderUploadedList",value:function(e){var t=this,n=e.map(function(e){return t.renderListItem(t.props.documents[e],!0)});return f.a.createElement(it.a,null,this.renderAddDocument(),n)}},{key:"renderCollectedList",value:function(e){var t=this;if(!e.length)return f.a.createElement(it.a,null,f.a.createElement(it.a.Item,null,f.a.createElement("div",{style:{color:"grey",textAlign:"center"}},"You haven't collected any document.")));var n=e.map(function(e){return t.renderListItem(t.props.documents[e],!1)});return f.a.createElement(it.a,null,n)}},{key:"renderStickyTab",value:function(){var e=this;return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(Jt.StickyContainer,null,f.a.createElement(ut.a,{tabs:[{title:"Uploaded"},{title:"Collected"}],initalPage:"t2",swipeable:!1,_renderTabBar:this.renderReactSticky},f.a.createElement("div",{style:{justifyContent:"center",height:"100%",backgroundColor:"#fff"}},this.renderUploadedList(y.a.orderBy(this.props.user.uploadedDocuments,function(t){return e.props.documents[t].upload_time},"desc"))),f.a.createElement("div",{style:{justifyContent:"center",height:"100%",backgroundColor:"#fff"}},this.renderCollectedList(y.a.orderBy(this.props.user.collectedDocuments,function(t){return e.props.documents[t].upload_time},"desc"))))),f.a.createElement(st.a,null))}},{key:"renderRenameModal",value:function(e){var t=this;return Ct.a.prompt("Rename","Enter the new name",[{text:"Cancel"},{text:"Confirm",onPress:function(n){var a=new FormData;a.append("new_title",n),a.append("csrfmiddlewaretoken",pn("csrftoken")),t.props.renameDocument(e.renameUrl,a)}}],"default",e.title)}},{key:"renderCollectedActionModal",value:function(){var e=this,t=this.props.documents[this.state.selectedDocument];return f.a.createElement(Ct.a,{popup:!0,visible:this.state.collectedActionModal,onClose:function(){return e.onClose("collectedActionModal")},animationType:"slide-up"},f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",{style:{color:"#1BA39C"}},t.title)},className:"popup-list"},f.a.createElement(it.a.Item,{onClick:function(){e.props.history.push("/add-to-readlists")}},f.a.createElement(rn.a,{style:{height:18,color:"#1BA39C",marginRight:20}}),"Add To Readlist"),this.props.match.params.groupUuid?null:f.a.createElement(it.a.Item,{onClick:function(){var e=window.location;mn([e.protocol,"//",e.host,"/documents/",t.slug].join("")),en.a.success("Copied to clipboard!",1)}},f.a.createElement(cn.a,{style:{height:18,color:"#1BA39C",marginRight:20}}),"Share"),f.a.createElement(it.a.Item,{onClick:function(){Ct.a.alert("Uncollect "+t.title+"?","",[{text:"Cancel"},{text:"Uncollect",style:{color:"#FF0000"},onPress:function(){e.onClose("collectedActionModal");var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),e.props.uncollectDocument(t.uncollectUrl,n,t.slug)}}])}},f.a.createElement(dn.a,{style:{height:18,color:"#e74c3c",marginRight:20}}),f.a.createElement("span",{style:{color:"#e74c3c"}},"Uncollect"))))}},{key:"renderUploadedActionModal",value:function(){var e=this,t=this.props.documents[this.state.selectedDocument];return f.a.createElement(Ct.a,{popup:!0,visible:this.state.uploadedActionModal,onClose:function(){return e.onClose("uploadedActionModal")},animationType:"slide-up"},f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",{style:{color:"#1BA39C"}},t.title)},className:"popup-list"},f.a.createElement(it.a.Item,{onClick:function(){e.props.history.push("/add-to-readlists/"+t.slug)}},f.a.createElement(rn.a,{style:{height:18,color:"#1BA39C",marginRight:20}}),"Add To Readlist"),this.props.match.params.groupUuid?null:f.a.createElement(it.a.Item,{onClick:function(){var e=window.location;mn([e.protocol,"//",e.host,"/documents/",t.slug].join("")),en.a.success("Copied to clipboard!",1)}},f.a.createElement(cn.a,{style:{height:18,color:"#1BA39C",marginRight:20}}),"Share"),f.a.createElement(it.a.Item,{onClick:function(){e.renderRenameModal(t)}},f.a.createElement(ln.a,{style:{height:18,color:"#1BA39C",marginRight:20}}),"Rename"),f.a.createElement(it.a.Item,{onClick:function(){Ct.a.alert("Delete "+t.title+"?","",[{text:"Cancel"},{text:"Delete",style:{color:"#FF0000"},onPress:function(){e.onClose("uploadedActionModal");var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),e.props.deleteDocument(t.delete_url,n,t.slug)}}])}},f.a.createElement(dn.a,{style:{height:18,color:"#e74c3c",marginRight:20}}),f.a.createElement("span",{style:{color:"#e74c3c"}},"Delete"))))}},{key:"render",value:function(){var e=this;return console.log(this.props.documents),this.state.loading?f.a.createElement("div",null,f.a.createElement(Bt,{title:"Uploads",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5})):f.a.createElement("div",null,f.a.createElement(Bt,{title:"Uploads",history:this.props.history,match:this.props.match}),this.renderStickyTab(),this.renderUploadedActionModal(),this.renderCollectedActionModal(),f.a.createElement("input",{ref:function(t){return e.finput=t},style:{visibility:"hidden"},type:"file",accept:"application/pdf",onChange:Object(ht.a)(mt.a.mark(function t(){return mt.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.handleFiles());case 1:case"end":return t.stop()}},t,this)}))}))}}]),t}(h.Component);var gn=Object(v.b)(function(e){return{user:e.user,documents:e.documents,coteries:e.coteries}},a)(fn),yn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={createdReadlistActionModal:!1,collectedReadlistActionModal:!1,selectedReadlist:null,loading:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.match.params.groupUuid?this.setState({loading:!1}):this.props.getMyReadlists().then(function(){e.setState({loading:!1})})}},{key:"renderReactSticky",value:function(e){return f.a.createElement(Jt.Sticky,null,function(t){var n=t.style;return f.a.createElement("div",{style:Object(dt.a)({},n,{zIndex:1})},f.a.createElement(ut.a.DefaultTabBar,e))})}},{key:"renderAddReadlist",value:function(){var e=this;return this.props.match.params.groupUuid?f.a.createElement("div",null):f.a.createElement(it.a.Item,{thumb:f.a.createElement(rn.a,{style:{color:"grey"}}),onClick:function(){e.props.history.push("/create-readlist-form")}},f.a.createElement("div",{style:{color:"grey"}},"New readlist"),f.a.createElement(it.a.Item.Brief,null,"Click to create..."))}},{key:"renderReadlist",value:function(e,t){var n=this;if(this.props.match.params.groupUuid)return f.a.createElement(it.a,null,f.a.createElement(it.a.Item,null,f.a.createElement("div",{style:{color:"grey",textAlign:"center"}},"Group-based readlists still in development.")));if(!e.length)return f.a.createElement(it.a,null,f.a.createElement(it.a.Item,null,f.a.createElement("div",{style:{color:"grey",textAlign:"center"}},"You haven't ",t?"created":"collected"," any readlists.")));var a=e.map(function(e){var t=n.props.readlists[e];return f.a.createElement("div",{key:e},f.a.createElement(it.a.Item,{thumb:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678072-folder-document-512.png",multipleLine:!0,arrow:"horizontal",onClick:function(){n.props.history.push("readlists/".concat(e))}},t.name,f.a.createElement(it.a.Item.Brief,null,nn()(t.create_time).format("MMMM Do YYYY, h:mm a"))))});return f.a.createElement("div",null,f.a.createElement(it.a,null,a))}},{key:"renderCreatedReadlists",value:function(){var e=this;return f.a.createElement("div",null,this.renderAddReadlist(),this.renderReadlist(y.a.orderBy(this.props.user.createdReadlists,function(t){return e.props.readlists[t].create_time},"desc"),!0))}},{key:"renderCollectedReadlists",value:function(){var e=this;return f.a.createElement("div",null,this.renderReadlist(y.a.orderBy(this.props.user.collectedReadlists,function(t){return e.props.readlists[t].create_time},"desc"),!1))}},{key:"renderStickyTab",value:function(){return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(Jt.StickyContainer,null,f.a.createElement(ut.a,{tabs:[{title:"Created"},{title:"Collected"}],initalPage:"t2",_renderTabBar:this.renderReactSticky},f.a.createElement("div",{style:{justifyContent:"center",height:"100%",backgroundColor:"#fff"}},this.renderCreatedReadlists()),f.a.createElement("div",{style:{justifyContent:"center",height:"100%",backgroundColor:"#fff"}},this.renderCollectedReadlists()))),f.a.createElement(st.a,null))}},{key:"render",value:function(){return this.state.loading?f.a.createElement("div",null,f.a.createElement(Bt,{title:"Readlists",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5})):f.a.createElement("div",null,f.a.createElement(Bt,{title:"Readlists",history:this.props.history,match:this.props.match}),this.renderStickyTab())}}]),t}(h.Component);var vn=Object(v.b)(function(e){return{user:e.user,readlists:e.readlists}},a)(yn),En=n(140),kn=n.n(En),bn=n(256),Cn=n.n(bn),wn=n(136),xn=n.n(wn),An=n(257),_n=n.n(An),Sn=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getCombinedNotifications().then(function(){e.props.getInvitations().then(function(){e.setState({loading:!1})})})}},{key:"getActionDescription",value:function(e){return"reply to annotation"===e||"reply to annotation reply"===e?"replied":"post annotation"===e?"posted":e}},{key:"formatNotificationTime",value:function(e){return nn()(e).isSame(nn()(),"day")?nn()(e).format("H:mm"):nn()(e).isSame(nn()(),"year")?nn()(e).format("M-d"):nn()(e).format("YYYY-M-d")}},{key:"renderInvitationList",value:function(e){var t=this,n=e.map(function(e){return f.a.createElement(it.a.Item,{key:e.pk,thumb:f.a.createElement(St.a,{style:{height:50,width:50,backgroundColor:"#1BA39C"}},f.a.createElement(kn.a,{style:{height:40}})),extra:f.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",float:"right"}},f.a.createElement(Cn.a,{style:{marginBottom:20,color:"1BA39C"},onClick:function(){Ct.a.alert("Accept","Accept invitation to join "+e.coterie_name+"?",[{text:"Cancel"},{text:"Join",style:{color:"#1BA39C"},onPress:function(){var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),t.props.acceptInvitation(e.accept_url,n,e.pk)}}])}}),f.a.createElement(xn.a,{style:{color:"red"},onClick:function(){Ct.a.alert("Decline","Decline invitation to join "+e.coterie_name+"?",[{text:"Cancel"},{text:"Decline",style:{color:"#FF0000"},onPress:function(){var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),t.props.declineInvitation(e.reject_url,n,e.pk)}}])}})),align:"middle",multipleLine:!0,wrap:!0,style:{backgroundColor:"#edf9f6"},onClick:function(){}},f.a.createElement("b",null,e.inviter_nickname+" invited you to join "+e.coterie_name),f.a.createElement(it.a.Item.Brief,null,e.invitation_message))});return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(it.a,{renderHeader:function(){return"Pending invitaions"},style:{textAlign:"left"}},n),f.a.createElement(st.a,null))}},{key:"renderNotificationsList",value:function(e){var t=this,n=e.map(function(e){var n=["reply to annotation","post annotation","reply to annotation reply"].includes(e.verb);return f.a.createElement(it.a.Item,{key:e.slug,thumb:n&&e.data?f.a.createElement("img",{src:e.data.image_url,style:{height:50,width:50,borderRadius:"50%"}}):f.a.createElement(St.a,{style:{height:50,width:50,backgroundColor:"#1BA39C"}},f.a.createElement(kn.a,{style:{height:40}})),extra:f.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column",float:"right"}},f.a.createElement("span",{style:{marginBottom:10}},t.formatNotificationTime(e.timestamp)),e.unread?f.a.createElement("span",{style:{textAlign:"right",zIndex:1e3},onClick:function(n){t.props.markNotificationAsRead(e.mark_read_url,e.slug),n.stopPropagation()}},f.a.createElement(kn.a,null)):f.a.createElement("span",{style:{textAlign:"right",zIndex:1}},f.a.createElement(_n.a,null))),align:"top",multipleLine:!0,style:{backgroundColor:e.unread?"#edf9f6":""},onClick:function(){t.props.markNotificationAsRead(e.mark_read_url,e.slug),n&&e.data&&t.props.history.push(e.data.redirect_url)}},e.unread?f.a.createElement("b",null,e.actor+" "+t.getActionDescription(e.verb)):e.actor+" "+t.getActionDescription(e.verb),f.a.createElement(it.a.Item.Brief,null,e.description))});return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(it.a,null,n),f.a.createElement(st.a,null))}},{key:"render",value:function(){if(this.state.loading)return f.a.createElement("div",null,f.a.createElement(Bt,{title:"Notifications",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5}));if(y.a.isEmpty(this.props.notifications)&&y.a.isEmpty(this.props.invitations))return f.a.createElement("div",null,f.a.createElement(Bt,{title:"Notifications",history:this.props.history,match:this.props.match}),f.a.createElement(it.a,null,f.a.createElement(it.a.Item,null,f.a.createElement(it.a.Item.Brief,null,"You are up to date!"))));var e=y.a.orderBy(this.props.notifications,"timestamp","desc"),t=y.a.orderBy(this.props.invitations,"pk","desc");return console.log(this.props),f.a.createElement("div",null,f.a.createElement(Bt,{title:"Notifications",history:this.props.history,match:this.props.match}),0!==t.length&&this.renderInvitationList(t),this.renderNotificationsList(e))}}]),t}(h.Component);var On=Object(v.b)(function(e){return{notifications:e.notifications,invitations:e.invitations}},a)(Sn),jn=(n(492),n(258)),Dn=n.n(jn),In=(n(495),n(141)),Rn=n.n(In),Mn=n(137),Tn=n.n(Mn),Bn=n(261),Ln=n.n(Bn),Pn=n(262),Fn=n.n(Pn),Nn=n(191),Un=n.n(Nn),zn=n(260),Hn=n.n(zn),Yn=n(43),Wn=n.n(Yn),Gn=n(55),Vn=n.n(Gn),Xn=n(187),Jn=n.n(Xn),Kn=n(190),qn=n.n(Kn),Qn=n(189),$n=n.n(Qn),Zn=n(259),ea=n.n(Zn),ta=n(188),na=n.n(ta),aa=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).handleChange=function(e){return function(t){n.setState(Object(wt.a)({},e,t.target.value))}},n.state={isFetching:!0,memberModal:!1,adminModal:!1,inviteDialog:!1,editDialog:!1},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getMyCoteries().then(function(){e.setState({isFetching:!1})})}},{key:"showModal",value:function(e,t){t.preventDefault(),this.setState(Object(wt.a)({},e,!0))}},{key:"onClose",value:function(e){this.setState(Object(wt.a)({},e,!1))}},{key:"handleFormSubmit",value:function(){var e=new FormData;e.append("coterie_id",this.props.coteries[this.props.match.params.groupUuid].pk),e.append("invitee_emails",this.state.emails),e.append("invitation_message",this.state.message?this.state.message:"No message"),e.append("csrfmiddlewaretoken",pn("csrftoken")),this.props.inviteToCoterie(e)}},{key:"handleGroupEdit",value:function(){var e=this,t=this.props.coteries[this.props.match.params.groupUuid],n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),this.state.new_name&&this.state.new_name!==t.name&&n.append("new_name",this.state.new_name),this.state.new_desc&&this.state.new_desc!==t.description&&n.append("new_desc",this.state.new_desc),this.props.updateCoterie(n,t.pk).then(function(n){e.props.updateCoterieSuccess(t.uuid,e.state.new_name,e.state.new_desc)})}},{key:"renderMember",value:function(e,t){var n=this,a=this.props.user.administratedCoteries.includes(t.uuid);return f.a.createElement(it.a.Item,{key:e.pk,thumb:f.a.createElement("img",{src:e.portrait_url,style:{borderRadius:"50%"}}),align:"middle",extra:a&&f.a.createElement(xn.a,{style:{color:"red"},onClick:function(){Ct.a.alert("Remove member "+e.nickname+"?","",[{text:"Cancel"},{text:"Remove",style:{color:"#FF0000"},onPress:function(){var a=new FormData;a.append("csrfmiddlewaretoken",pn("csrftoken")),a.append("member_email_address",e.email_address),n.props.removeMember(t.remove_member_url,a,t.uuid,e.email_address)}}])}})},e.nickname)}},{key:"renderAdmin",value:function(e){return f.a.createElement(it.a.Item,{key:e.pk,thumb:f.a.createElement("img",{src:e.portrait_url,style:{borderRadius:"50%"}})},e.nickname)}},{key:"renderGroupInfo",value:function(e){var t=this,n=this.props.user.administratedCoteries.includes(e.uuid);return f.a.createElement(Dn.a,{size:"lg"},f.a.createElement(st.a,{size:"lg"}),f.a.createElement(Rn.a,null,f.a.createElement(Rn.a.Header,{title:f.a.createElement("span",{style:{marginLeft:20}},e.name),thumb:f.a.createElement(Dt.a,{style:{color:"rgb(101, 119, 134)"}}),extra:n&&f.a.createElement(Tn.a,{onClick:function(e){t.showModal("editDialog",e)}})}),f.a.createElement(Rn.a.Body,null,f.a.createElement("div",null,e.description))),f.a.createElement(st.a,{size:"lg"}))}},{key:"renderMemberModal",value:function(e){var t=this;return f.a.createElement(Ct.a,{popup:!0,visible:this.state.memberModal,onClose:function(){return t.onClose("memberModal")},animationType:"slide-up",style:{overflow:"auto",maxHeight:"80vh"}},f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",{style:{color:"#1BA39C"}},"Members")},className:"popup-list"},e.members.map(function(n){return t.renderMember(n,e)})))}},{key:"renderAdminModal",value:function(e){var t=this;return f.a.createElement(Ct.a,{popup:!0,visible:this.state.adminModal,onClose:function(){return t.onClose("adminModal")},animationType:"slide-up",style:{overflow:"auto",maxHeight:"80vh"}},f.a.createElement(it.a,{renderHeader:function(){return f.a.createElement("b",{style:{color:"#1BA39C"}},"Administrators")},className:"popup-list"},e.administrators.map(function(e){return t.renderAdmin(e)})))}},{key:"renderInviteDialog",value:function(){var e=this;return f.a.createElement("div",null,f.a.createElement(Jn.a,{open:this.state.inviteDialog,onClose:function(){return e.onClose("inviteDialog")},"aria-labelledby":"form-dialog-title"},f.a.createElement(na.a,{id:"form-dialog-title"},"Invite new members"),f.a.createElement($n.a,null,f.a.createElement(ea.a,null,"To invite new member to the group, enter the email addresses here separated by commas. We will send invitation messages."),f.a.createElement(Vn.a,{required:!0,autoFocus:!0,multiline:!0,margin:"dense",id:"emails",label:"Email Address",type:"email",fullWidth:!0,onChange:this.handleChange("emails")}),f.a.createElement(Vn.a,{required:!0,multiline:!0,margin:"dense",id:"message",label:"Message",fullWidth:!0,onChange:this.handleChange("message")})),f.a.createElement(qn.a,null,f.a.createElement(Wn.a,{onClick:function(){return e.onClose("inviteDialog")},color:"primary"},"Cancel"),f.a.createElement(Wn.a,{disabled:y.a.isEmpty(this.state.emails),onClick:function(){e.onClose("inviteDialog"),e.handleFormSubmit()},color:"primary"},"Send"))))}},{key:"renderEditDialog",value:function(){var e=this,t=this.props.coteries[this.props.match.params.groupUuid];return f.a.createElement("div",null,f.a.createElement(Jn.a,{open:this.state.editDialog,onClose:function(){return e.onClose("editDialog")},"aria-labelledby":"form-dialog-title"},f.a.createElement(na.a,{id:"form-dialog-title"},"Edit Group Info"),f.a.createElement($n.a,null,f.a.createElement(Vn.a,{autoFocus:!0,multiline:!0,margin:"dense",id:"new_name",label:"New name",defaultValue:t.name,fullWidth:!0,onChange:this.handleChange("new_name")}),f.a.createElement(Vn.a,{multiline:!0,margin:"dense",id:"new_desc",label:"New description",defaultValue:t.description,fullWidth:!0,onChange:this.handleChange("new_desc")})),f.a.createElement(qn.a,null,f.a.createElement(Wn.a,{onClick:function(){return e.onClose("editDialog")},color:"primary"},"Cancel"),f.a.createElement(Wn.a,{onClick:function(){e.onClose("editDialog"),e.handleGroupEdit()},color:"primary"},"Send"))))}},{key:"render",value:function(){var e=this;if(y.a.isEmpty(this.props.user)||this.state.isFetching)return f.a.createElement("div",null,f.a.createElement(Bt,{title:"Settings",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5}));if(!this.props.match.params.groupUuid)return f.a.createElement("div",null,f.a.createElement(Bt,{title:"Settings",history:this.props.history,match:this.props.match}),f.a.createElement("h2",null," You are in the public group. "));var t=this.props.coteries[this.props.match.params.groupUuid],n=this.props.user.administratedCoteries.includes(t.uuid);return f.a.createElement("div",null,f.a.createElement(Bt,{title:"Settings",history:this.props.history,match:this.props.match}),this.renderGroupInfo(t),f.a.createElement(it.a,null,f.a.createElement(it.a.Item,{thumb:f.a.createElement(Hn.a,{style:{color:"orange"}}),extra:t.administrators.length,arrow:"horizontal",onClick:function(t){e.showModal("adminModal",t)}},"Administrators"),f.a.createElement(it.a.Item,{thumb:f.a.createElement(Ln.a,{style:{color:"42A5F5"}}),extra:t.members.length,arrow:"horizontal",onClick:function(t){e.showModal("memberModal",t)}},"Members"),n&&f.a.createElement(it.a.Item,{thumb:f.a.createElement(Fn.a,{style:{color:"#1BA39C"}}),onClick:function(t){e.showModal("inviteDialog",t)}},"Add someone")),f.a.createElement(st.a,{size:"lg"}),!n&&f.a.createElement(it.a,null,f.a.createElement(it.a.Item,{thumb:f.a.createElement(Un.a,{style:{color:"#FF0000"}}),onClick:function(){Ct.a.alert("Leave "+t.name+"?","Are you sure to exit this group? This cannot be undone",[{text:"Cancel"},{text:"Leave",style:{color:"#FF0000"},onPress:function(){var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),e.props.leaveCoterie(n,t.pk,t.uuid),e.props.history.push("/explore")}}])}},"Leave group")),n&&f.a.createElement(it.a,null,f.a.createElement(it.a.Item,{thumb:f.a.createElement(Un.a,{style:{color:"#FF0000"}}),onClick:function(){Ct.a.alert("Delete "+t.name+"?","Are you sure? Deleting the group can affect all existing members. This cannot be undone",[{text:"Cancel"},{text:"Leave",style:{color:"#FF0000"},onPress:function(){var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),e.props.deleteCoterie(n,t.pk,t.uuid),e.props.history.push("/explore")}}])}},"Delete group")),this.renderAdminModal(t),this.renderMemberModal(t),this.renderInviteDialog(),this.renderEditDialog())}}]),t}(h.Component);var ra=Object(v.b)(function(e){return{user:e.user,coteries:e.coteries}},a)(aa),oa=function(e){var t=e.match;return f.a.createElement(o.a,null,f.a.createElement(i.a,{path:"".concat(t.url,"/:groupUuid?/explore"),component:$t}),f.a.createElement(i.a,{path:"".concat(t.url,"/:groupUuid?/uploads"),component:gn}),f.a.createElement(i.a,{path:"".concat(t.url,"/:groupUuid?/readlists"),component:vn}),f.a.createElement(i.a,{path:"".concat(t.url,"/:groupUuid?/notifications"),component:On}),f.a.createElement(i.a,{path:"".concat(t.url,"/:groupUuid?/settings"),component:ra}))},ia=function(){return f.a.createElement("main",null,f.a.createElement(o.a,null,f.a.createElement(i.a,{path:"/groups",component:oa}),f.a.createElement(i.a,{path:"/explore",component:qt}),f.a.createElement(i.a,{path:"/uploads",component:gn}),f.a.createElement(i.a,{path:"/readlists",component:vn}),f.a.createElement(i.a,{path:"/notifications",component:On}),f.a.createElement(i.a,{path:"/settings",component:ra})))},la=n(132),sa=n.n(la),ca=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.getUser(),this.props.getMyCoteries().then(function(){e.setState({loading:!1})})}},{key:"render",value:function(){return y.a.isEmpty(this.props.user)||this.state.loading?f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5}):f.a.createElement("div",{className:"App"},f.a.createElement(rt,{path:this.props.location.pathname,history:this.props.history,content:f.a.createElement(ia,null)}))}}]),t}(h.Component);var ua=Object(v.b)(function(e){return{user:e.user,coteries:e.coteries}},a)(ca),da=(n(176),n(93)),pa=n.n(da),ma=(n(178),n(94)),ha=n.n(ma),fa=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={coterie_name:"",coterie_description:""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleSubmit",value:function(){var e=this.state,t=e.coterie_name,n=e.coterie_description,a=new FormData;a.append("coterie_name",t),a.append("coterie_description",n),a.append("csrfmiddlewaretoken",pn("csrftoken")),this.props.createCoterie(a),this.props.history.goBack()}},{key:"render",value:function(){var e=this;return f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",color:"#1BA39C"}),onLeftClick:function(){return e.props.history.goBack()}},"Create Group"),f.a.createElement(it.a,{renderHeader:function(){return"You will be the administrator upon creation"}},f.a.createElement(ha.a,{clear:!0,placeholder:"Name of the group",onChange:function(t){return e.setState({coterie_name:t})}},"Name")),f.a.createElement(it.a,{renderHeader:function(){return"Description"}},f.a.createElement(pa.a,{rows:5,count:100,onChange:function(t){return e.setState({coterie_description:t})}}),f.a.createElement(it.a.Item,null,f.a.createElement(vt.a,{disabled:0===this.state.coterie_name.length,type:"primary",style:{backgroundColor:"#1BA39C"},onClick:function(){return e.handleSubmit()}},"Create"))))}}]),t}(h.Component);var ga=Object(v.b)(function(e){return{}},a)(fa),ya=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={readlist_name:"",readlist_description:""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"handleSubmit",value:function(){var e=this.state,t=e.readlist_name,n=e.readlist_description,a=new FormData;a.append("readlist_name",t),a.append("description",n),a.append("csrfmiddlewaretoken",pn("csrftoken")),this.props.createReadlist(a),this.props.history.goBack()}},{key:"render",value:function(){var e=this;return f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",color:"#1BA39C"}),onLeftClick:function(){return e.props.history.goBack()}},"Create Readlist"),f.a.createElement(it.a,null,f.a.createElement(ha.a,{clear:!0,placeholder:"Name of the readlist",onChange:function(t){return e.setState({readlist_name:t})}},"Name")),f.a.createElement(it.a,{renderHeader:function(){return"Description"}},f.a.createElement(pa.a,{rows:5,count:100,onChange:function(t){return e.setState({readlist_description:t})}}),f.a.createElement(it.a.Item,null,f.a.createElement(vt.a,{disabled:0===this.state.readlist_name.length,type:"primary",style:{backgroundColor:"#1BA39C"},onClick:function(){return e.handleSubmit()}},"Create"))))}}]),t}(h.Component);var va=Object(v.b)(function(e){return{}},a)(ya),Ea=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={readlist_name:"",readlist_description:""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.slug;this.props.getReadlist(t).then(function(){e.setState({readlist_name:e.props.readlists.readlist.name,readlist_description:e.props.readlists.readlist.description})})}},{key:"handleSubmit",value:function(){var e=this,t=this.state,n=t.readlist_name,a=t.readlist_description,r=new FormData;r.append("new_name",n),r.append("new_desc",a),r.append("csrfmiddlewaretoken",pn("csrftoken")),this.props.editReadlist(this.props.readlists.readlist.rename_url,r).then(function(){e.props.editReadlist(e.props.readlists.readlist.change_desc_url,r)}).then(function(){e.props.history.goBack()})}},{key:"handleDelete",value:function(){var e=this,t=this.props.readlists.readlist;Ct.a.alert("Delete "+this.state.readlist_name+"?","All followers and you will no longer have access",[{text:"Cancel"},{text:"Delete",style:{color:"#FF0000"},onPress:function(){var n=new FormData;n.append("csrfmiddlewaretoken",pn("csrftoken")),e.props.deleteReadlist(t.delete_url,n,t.slug),e.props.history.push("/readlists")}}])}},{key:"render",value:function(){var e,t=this;return f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",color:"#1BA39C"}),onLeftClick:function(){return t.props.history.goBack()}},"Edit Readlist"),f.a.createElement(st.a,null),f.a.createElement(st.a,null),f.a.createElement(it.a,null,f.a.createElement(ha.a,{clear:!0,placeholder:"Name of the readlist",value:this.state.readlist_name,onChange:function(e){return t.setState({readlist_name:e})}},"Name")),f.a.createElement(it.a,{renderHeader:function(){return"Description"}},f.a.createElement(pa.a,{rows:5,count:100,value:this.state.readlist_description,onChange:function(e){return t.setState({readlist_description:e})}}),f.a.createElement(it.a.Item,null,f.a.createElement(vt.a,{disabled:0===this.state.readlist_name.length,type:"primary",style:{backgroundColor:"#1BA39C"},onClick:function(){return t.handleSubmit()}},"Edit")),f.a.createElement(it.a.Item,null,f.a.createElement(vt.a,(e={type:"danger"},Object(wt.a)(e,"type","primary"),Object(wt.a)(e,"style",{backgroundColor:"#e74c3c"}),Object(wt.a)(e,"onClick",function(){return t.handleDelete()}),e),"Delete"))))}}]),t}(h.Component);var ka=Object(v.b)(function(e){return{readlists:e.readlists}},a)(Ea),ba=(n(576),n(263)),Ca=n.n(ba),wa=n(193),xa=n(64);n(579);function Aa(e){return Array(e-0).fill().map(function(e,t){return 0+t})}var _a=n(272),Sa=n.n(_a),Oa=n(265),ja=n.n(Oa),Da=n(266),Ia=n.n(Da),Ra=n(267),Ma=n.n(Ra),Ta=n(142),Ba=n.n(Ta),La=n(22),Pa=n.n(La),Fa=n(59),Na=n.n(Fa),Ua=n(264),za=Object(At.withStyles)({root:{height:"20px",margin:"5px"},avatar:{height:"20px",width:"20px"}})(ja.a),Ha=Object(At.withStyles)({root:{minWidth:0}})(Wn.a);function Ya(e){var t,n,a,r,o=!!e.annotator,i=o?e.annotator:e.replier;return t=i.nickname?i.nickname:"Anonymous",n=i.portrait_url?i.portrait_url:"/media/portrait/anonymous_portrait.png",null===e.edit_time?(a="posted",r=e.post_time):(a="edited",r=e.edit_time),{nickname:t,portrait_url:n,prefix:a,timeago:r,content:e.content,uuid:e.uuid,pk:e.pk,numReplies:e.replies?e.replies.length:0,isAnnotation:o}}var Wa=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={commentMenuElement:null,commentMenuUuid:null},n.openContextMenu=function(e,t,a){n.setState({commentMenuElement:e.currentTarget,selectedComment:t,selectedCommentIsReply:!a})},n.closeContextMenu=function(e){n.setState({commentMenuElement:null,selectedComment:null})},n.locateComment=function(e){e.scrollIntoView({behavior:"smooth"})},n.replyAnnotation=function(e){n.props.setParentState({replyToAnnotationReplyId:null,replyToAnnotationReplyUuid:null,annotationOpen:!1,annotationLinearLinkedListOpen:!0})},n.replyReply=function(e){n.props.setParentState({replyToAnnotationReplyId:e.pk,replyToAnnotationReplyUuid:e.uuid,annotationOpen:!1,annotationLinearLinkedListOpen:!0})},n.likeAnnotation=function(e){var t=new FormData;t.append("csrfmiddlewaretoken",pn("csrftoken")),t.append("operation","like_annotation"),t.append("annotation_id",e.pk),k.a.post(window.location.pathname+"/",t).then(function(t){n.setState({likeSet:n.state.likeSet.add(e.uuid)})})},n.likeReply=function(e){var t=new FormData;t.append("csrfmiddlewaretoken",pn("csrftoken")),t.append("operation","like_annotation_reply"),t.append("annotation_reply_id",e.pk),k.a.post(window.location.pathname+"/",t).then(function(t){n.setState({likeSet:n.state.likeSet.add(e.uuid)})})},n.editComment=function(){n.closeContextMenu(),n.props.setParentState({annotationOpen:!1,editCommentOpen:!0,editTextContent:n.state.selectedComment.content,selectedComment:n.state.selectedComment})},n.shareComment=function(){var e=[window.location.protocol,"//",window.location.host,window.location.pathname].join("")+"?annotation="+n.state.selectedComment.uuid;mn(e),console.log(e),n.closeContextMenu()},n.deleteComment=function(){var e=n.state.selectedCommentIsReply?"delete_annotation_reply":"delete_annotation",t=n.state.selectedCommentIsReply?"reply_id":"annotation_id",a=(parseInt(n.state.selectedComment.page_index),new FormData);a.append("csrfmiddlewaretoken",pn("csrftoken")),a.append("operation",e),a.append(t,n.state.selectedComment.pk),a.append("document_id",n.props.pdfDocument.pk),console.log(n.state.selectedComment);var r=n.props.selectedAnnotation,o=n.props.annotations,i=n.props.annotationsByPage,l=n.state.selectedComment;k.a.post(window.location.pathname+"/",a).then(function(e){if(console.log(e),console.log(o),console.log(i),n.state.selectedCommentIsReply){var t=0;r.replies.map(function(e){e.uuid==l.uuid&&(r.replies.splice(t,1),o[r.uuid]=r,n.props.setParentState({annotations:o})),t++})}else{delete o[r.uuid];t=0;i[r.page_index].map(function(e){e.uuid==r.uuid&&(i[r.page_index].splice(t,1),n.props.setParentState({annotations:o,annotationsByPage:i,annotationOpen:!1,selectedAnnotation:void 0})),t++})}}),n.closeContextMenu()},n.state.likeSet=new Set,n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"commentBlock",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return f.a.createElement("div",{key:e.uuid,className:n?"comment-head":"comment-body"},f.a.createElement(zt.a,null,f.a.createElement(zt.a,{container:!0,justify:"flex-start",alignItems:"center",wrap:"nowrap"},f.a.createElement(zt.a,{item:!0},f.a.createElement(za,{label:e.nickname,avatar:f.a.createElement(St.a,{src:e.portrait_url})})),f.a.createElement(zt.a,{item:!0},f.a.createElement(Na.a,{variant:"caption"},e.prefix," ",f.a.createElement(Nt.a,{date:e.timeago})))),f.a.createElement(zt.a,null,f.a.createElement("div",{className:"comment-text",dangerouslySetInnerHTML:{__html:e.content}})),f.a.createElement(zt.a,{container:!0,justify:"space-between",alignItems:"center",wrap:"nowrap"},f.a.createElement(zt.a,{container:!0,justify:"flex-start",alignItems:"center",wrap:"nowrap"},n&&f.a.createElement(za,{icon:f.a.createElement(Ia.a,null),label:e.numReplies+(1===e.numReplies?" reply":" replies"),variant:"outlined"})),f.a.createElement(zt.a,{container:!0,justify:"flex-end",alignItems:"center",wrap:"nowrap"},n&&f.a.createElement(zt.a,{item:!0},f.a.createElement(Ha,{color:"primary",onClick:function(){t.locateComment(t.props.annotationArea)}},f.a.createElement(Ot.a,{icon:xt.c}))),f.a.createElement(zt.a,{item:!0},f.a.createElement(Ha,{color:"primary",onClick:function(){n?t.replyAnnotation(e):t.replyReply(e)}},f.a.createElement(Ot.a,{icon:xt.f}))),f.a.createElement(zt.a,{item:!0},f.a.createElement(Ha,{color:"primary",style:{color:"#1BA39C"},disabled:this.state.likeSet.has(e.uuid),onClick:function(){n?t.likeAnnotation(e):t.likeReply(e)}},f.a.createElement(Ot.a,{icon:this.state.likeSet.has(e.uuid)?xt.g:Ua.a}))),f.a.createElement(zt.a,{item:!0},f.a.createElement(Ha,{color:"primary",onClick:function(a){return t.openContextMenu(a,e,n)}},f.a.createElement(Ot.a,{icon:xt.a})))))))}},{key:"componentDidMount",value:function(){window.hasOwnProperty("MathJax")&&MathJax.Hub.Queue(["Typeset",MathJax.Hub])}},{key:"render",value:function(){var e=this,t=this.state.commentMenuElement,n=Boolean(t),a=this.props.selectedAnnotation;return f.a.createElement("div",null,this.commentBlock(Ya(a),!0),a.replies.map(function(t){return e.commentBlock(Ya(t))}),f.a.createElement(Ma.a,{className:"menu",anchorEl:t,open:n,onClose:this.closeContextMenu,PaperProps:{style:{maxHeight:216}}},f.a.createElement(Ba.a,{onClick:this.editComment},f.a.createElement(Ha,{color:"primary"},f.a.createElement(Ot.a,{icon:xt.e})),f.a.createElement(Na.a,null,"Edit")),f.a.createElement(Ba.a,{onClick:this.shareComment},f.a.createElement(Ha,{color:"primary"},f.a.createElement(Ot.a,{icon:xt.b})),f.a.createElement(Na.a,null,"Share link")),f.a.createElement(Ba.a,{onClick:this.deleteComment},f.a.createElement(Ha,{color:"primary"},f.a.createElement(Ot.a,{icon:xt.i})),f.a.createElement(Na.a,null,"Delete"))))}}]),t}(f.a.Component);var Ga=Object(v.b)(function(e){return{user:e.user,coteries:e.coteries}},a)(Wa),Va=n(273),Xa=n.n(Va),Ja=n(109),Ka=n.n(Ja),qa=n(182),Qa=n.n(qa),$a=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e,n))).state={value:0,content:void 0},a.onClick=function(){a.props.clickCallback()},a}return Object(m.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.theme;n.transitions.duration.enteringScreen,n.transitions.duration.leavingScreen;return f.a.createElement(Qa.a,{in:this.props.show},f.a.createElement(Wn.a,{variant:"fab",className:t.fab+" scan-receipt-btn",style:{position:"fixed",bottom:60,zIndex:1e3,backgroundColor:this.props.color},onClick:this.onClick},this.props.icon))}}]),t}(f.a.Component),Za=Object(At.withStyles)(function(e){return{root:{position:"relative",minHeight:200},fab:{position:"absolute",bottom:2*e.spacing.unit,right:2*e.spacing.unit}}},{withTheme:!0})($a),er=n(269),tr=n.n(er),nr=n(271),ar=n.n(nr),rr=n(270),or=n.n(rr),ir=n(284),lr=n(192),sr=n.n(lr),cr=n(66),ur=n.n(cr);Mt.b.add(xt.d,xt.h);var dr="RENDERING",pr=8,mr=8,hr=Ct.a.alert,fr=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).pdfDoc=void 0,n.taskList=[],n.finishList=[],n.rendering=!1,n.clearnessLevel=3.8,n.currentPageIndex=1,n.annotationAreas={},n.prevScroll=window.pageYOffset,n.annotationFirstTouch=!1,n.state={document:{title:""},loading:!0,numPages:0,currentScale:1,scaleFactor:1.08,sampleWidth:void 0,sampleHeight:void 0,annotations:{},annotationsByPage:{},annotationOpen:!1,annotationLinearLinkedListOpen:!1,editCommentOpen:!1,newAnnotationInputOpen:!1,selectedAnnotation:void 0,mode:"view",showFloatButton:!0,creatingAnnotationAtPageIndex:void 0,newAnnotationContent:"",newAnnotationReplyContent:"",editTextContent:""},n.dynamicRenderOnScroll=function(){var e=Math.ceil(window.pageYOffset/n.viewerWrappper.scrollHeight*n.state.numPages);if(e!==n.currentPageIndex){n.currentPageIndex=e;for(var t=Aa(9).map(function(e){return!0}),a=0,r=0;r<n.finishList.length;r++)if(n.finishList[a]-e>=-2&&n.finishList[a]-e<=6)t[n.finishList[a]-(e-2)]=!1,a+=1;else{var o=document.getElementById("page-canvas-"+n.finishList[a]);o.width=0,o.height=0,n.finishList.splice(a,1)}n.taskList.splice(1);for(r=0;r<t.length;r++)t[r]&&n.pushNewPageRenderingTask(e-2+r);n.rendering||n.renderTaskList()}},n.handleScroll=function(){n.dynamicRenderOnScroll();var e=window.pageYOffset;e-n.prevScroll>8?n.setState({showFloatButton:!1}):n.prevScroll-e>8&&n.setState({showFloatButton:!0}),n.prevScroll=e},n.pushNewPageRenderingTask=function(e){e>=1&&e<=n.state.numPages&&n.taskList.push({pageIndex:e,status:dr,taskObj:null})},n.renderTaskList=function(){if(!(n.taskList.length<=0)){n.rendering=!0;var e=n.state.currentScale,t=n.clearnessLevel,a=n.taskList[0].pageIndex,r=Object(xa.a)(Object(xa.a)(n));n.pdfDoc.getPage(a).then(function(n){var o=document.getElementById("page-canvas-"+a);if(null!==o){var i=o.getContext("2d"),l=n.getViewport(t*e);o.height=l.height,o.width=l.width,o.style.height=l.height/t+"px",o.style.width=l.width/t+"px";var s={canvasContext:i,viewport:l};r.taskList[0].status=dr,r.taskList[0].taskObj=n.render(s),r.taskList[0].taskObj.promise.then(function(){r.taskList.shift(),r.finishList.push(a),r.rendering=!1,r.renderTaskList()})}})}},n.renderAnnotationAreas=function(e){var t,a;k.a.get((t=n.props.match.params.slug,a=n.props.isGroupDocument,a?"/coteries/api/coteriedocuments/byslug/"+t+"/annotations":"/file_viewer/api/documents/byslug/"+t+"/annotations")).then(function(t){for(var a=t.data,r={},o={},i=1;i<=e;i++)r[i]=[];var l=!0,s=!1,c=void 0;try{for(var u,d=a[Symbol.iterator]();!(l=(u=d.next()).done);l=!0){var p=u.value;r[parseInt(p.page_index)].push(p),o[p.uuid]=p}}catch(m){s=!0,c=m}finally{try{l||null==d.return||d.return()}finally{if(s)throw c}}n.setState({annotations:o,annotationsByPage:r}),console.log(o),console.log(r)})},n.configSizeAccordingToLastPageAndRenderTheFirstSeveralPages=function(e){var t=Object(xa.a)(Object(xa.a)(n));e.getPage(e.numPages).then(function(e){var n=1*window.innerWidth/e.getViewport(1).width;t.setState({currentScale:n,sampleWidth:e.getViewport(n).width,sampleHeight:e.getViewport(n).height}),t.pushNewPageRenderingTask(1),t.pushNewPageRenderingTask(2),t.renderTaskList()})},n.styleDrawer=function(){void 0!==n.annotationWrapper&&(n.annotationWrapper.parentElement.classList.contains("annotation-drawer")||n.annotationWrapper.parentElement.classList.add("annotation-drawer"))},n.selectAnnotation=function(e){void 0!==n.state.selectedAnnotation&&n.annotationAreas[n.state.selectedAnnotation.uuid].classList.remove("highlighted-annotation-area"),n.setState({selectedAnnotation:n.state.annotations[e]}),n.annotationAreas[e].classList.add("highlighted-annotation-area");var t=n.annotationAreas[e].style.background;n.annotationAreas[e].style.borderColor=t.split(",").slice(0,3).join(",")+", 0.38)",n.state.annotationOpen||(n.styleDrawer(),n.setState({annotationOpen:!0,annotationLinearLinkedListOpen:!1,editCommentOpen:!1}))},n.deselectAnnotation=function(){void 0!==n.state.selectedAnnotation&&n.annotationAreas[n.state.selectedAnnotation.uuid].classList.remove("highlighted-annotation-area"),n.setState({annotationOpen:!1}),n.setState({selectedAnnotation:void 0})},n.lockScroll=function(e){1===e.targetTouches.length&&e.preventDefault()},n.changeToCommentMode=function(){n.setState({mode:"comment"}),document.getElementsByTagName("BODY")[0].addEventListener("touchmove",n.lockScroll,{passive:!1})},n.changeToViewMode=function(){n.setState({mode:"view",creatingAnnotationAtPageIndex:void 0,newAnnotationInputOpen:!1}),document.getElementsByTagName("BODY")[0].removeEventListener("touchmove",n.lockScroll)},n.postAnnotation=function(){if(!(n.state.newAnnotationWidth<pr||n.state.newAnnotationHeight<mr)){var e=new FormData;e.append("csrfmiddlewaretoken",pn("csrftoken")),e.append("operation","annotate"),e.append("page_id","page_id_"+n.state.creatingAnnotationAtPageIndex),e.append("annotation_content",n.state.newAnnotationContent),e.append("top_percent",n.state.newAnnotationY/n.state.sampleHeight),e.append("left_percent",n.state.newAnnotationX/n.state.sampleWidth),e.append("height_percent",n.state.newAnnotationHeight/n.state.sampleHeight),e.append("width_percent",n.state.newAnnotationWidth/n.state.sampleWidth),e.append("frame_color",window.getComputedStyle(document.getElementById("annotation-being-created"),null).getPropertyValue("background-color")),e.append("document_id",n.state.document.pk),e.append("is_public",!0),k.a.post(window.location.pathname+"/",e).then(function(e){var t=e.data.new_annotation_json,a=n.state.annotationsByPage,r=n.state.annotations;a[parseInt(t.page_index)].push(t),r[t.uuid]=t,n.setState({annotations:r,annotationsByPage:a,newAnnotationContent:"",mode:"view",creatingAnnotationAtPageIndex:void 0,newAnnotationInputOpen:!1}),document.getElementsByTagName("BODY")[0].removeEventListener("touchmove",n.lockScroll)}).catch(function(e){hr("","You need to login to post",[{text:"Cancel",onPress:function(){}},{text:"Go login",onPress:function(){return n.props.history.push("/sign-in")}}])})}},n.cancelCurrentAnnotation=function(){n.setState({creatingAnnotationAtPageIndex:void 0,newAnnotationInputOpen:!1})},n.postAnnotationReply=function(){var e=new FormData;console.log(n.state.replyToAnnotationReplyId),e.append("csrfmiddlewaretoken",pn("csrftoken")),e.append("operation","reply_annotation"),e.append("annotation_reply_content",n.state.newAnnotationReplyContent),e.append("reply_to_annotation_id",n.state.selectedAnnotation.pk),n.state.replyToAnnotationReplyId&&e.append("reply_to_annotation_reply_id",n.state.replyToAnnotationReplyId),e.append("document_id",n.state.document.pk),e.append("is_public",!0),k.a.post(window.location.pathname+"/",e).then(function(e){var t=n.state.annotations;t[n.state.selectedAnnotation.uuid].replies.push(e.data.new_annotationreply_json),n.setState({annotations:t,newAnnotationReplyContent:"",annotationOpen:!0,annotationLinearLinkedListOpen:!1})})},n.cancelCurrentAnnotationReply=function(){n.setState({annotationOpen:!0,annotationLinearLinkedListOpen:!1})},n.postEdit=function(){var e="/"+window.location.pathname.split("/")[1]+(n.state.selectedComment.isAnnotation?"/api/annotations/":"/api/annotationreplies/")+n.state.selectedComment.pk+"/edit";console.log(e);var t=new FormData;t.append("csrfmiddlewaretoken",pn("csrftoken")),t.append("new_content",n.state.editTextContent),k.a.post(e,t).then(function(e){var t=n.state.annotations;if(n.state.selectedComment.isAnnotation)t[n.state.selectedAnnotation.uuid].content=n.state.editTextContent;else for(var a=0;a<t[n.state.selectedAnnotation.uuid].replies.length;a++)if(t[n.state.selectedAnnotation.uuid].replies[a].uuid==n.state.selectedComment.uuid){t[n.state.selectedAnnotation.uuid].replies[a].content=n.state.editTextContent;break}n.setState({annotationOpen:!0,editCommentOpen:!1,annotations:t})})},n.cancelEdit=function(){n.setState({annotationOpen:!0,editCommentOpen:!1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e,t,n=this;k.a.get((e=this.props.match.params.slug,t=this.props.isGroupDocument,t?"/coteries/api/coteriedocuments/byslug/"+e:"/file_viewer/api/documents/byslug/"+e)).then(function(e){n.setState({document:e.data}),console.log(e.data),PDFJS.workerSrc="/static/pdfjs/pdf.worker.js";var t=n;PDFJS.getDocument(e.data.url).then(function(e){t.pdfDoc=e,t.setState({numPages:e.numPages}),t.setState({loading:!1}),t.renderAnnotationAreas(e.numPages),t.configSizeAccordingToLastPageAndRenderTheFirstSeveralPages(e)}),window.addEventListener("scroll",n.handleScroll,{passive:!0})})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"render",value:function(){var e=this,t=this.state.selectedAnnotation;function n(e,t){var n=e.touches.item(0).pageX,a=e.touches.item(0).pageY,r=document.getElementById("page-div-"+t);return[n-r.offsetLeft,a-r.offsetTop]}function a(e){var t;t=null===e.touches.item(0)?e.target:e.touches.item(0).target;var n=document.getElementById("annotation-being-created");return!(null===n||n!==t&&!n.contains(t))}var r=f.a.createElement("div",{ref:function(t){return e.viewerWrappper=t},className:"viewer-wrapper"},Aa(this.state.numPages).map(function(t){var r=t+1;return f.a.createElement("div",{className:"page-div",key:r,id:"page-div-"+r,style:{position:"relative",width:e.state.sampleWidth,height:e.state.sampleHeight},onTouchStart:function(t){if("view"!==e.state.mode&&!a(t)&&void 0===e.state.creatingAnnotationAtPageIndex){e.annotationFirstTouch=!0;var o=n(t,r),i=Object(wa.a)(o,2),l=i[0],s=i[1];e.setState({creatingAnnotationAtPageIndex:r,originalAnnotationX:l,originalAnnotationY:s,newAnnotationX:l,newAnnotationY:s,newAnnotationWidth:0,newAnnotationHeight:0})}},onTouchMove:function(t){if("view"!==e.state.mode&&!a(t)&&e.annotationFirstTouch){var o=n(t,r),i=Object(wa.a)(o,2),l=i[0],s=i[1],c=l>e.state.originalAnnotationX?e.state.originalAnnotationX:l;c=Math.max(.01,c);var u=s>e.state.originalAnnotationY?e.state.originalAnnotationY:s;u=Math.max(.01,u);var d=Math.abs(l-e.state.originalAnnotationX);d=l<e.state.originalAnnotationX?Math.min(d,e.state.originalAnnotationX):Math.min(d,e.state.sampleWidth-c);var p=Math.abs(s-e.state.originalAnnotationY);p=s<e.state.originalAnnotationY?Math.min(p,e.state.originalAnnotationY):Math.min(p,e.state.sampleHeight-u),e.setState({newAnnotationWidth:d,newAnnotationHeight:p}),e.rnd.updatePosition({x:c,y:u})}},onTouchEnd:function(t){if("view"!==e.state.mode&&!a(t))return e.setState({newAnnotationX:e.rnd.draggable.state.x,newAnnotationY:e.rnd.draggable.state.y,newAnnotationWidth:e.rnd.props.size.width,newAnnotationHeight:e.rnd.props.size.height}),e.annotationFirstTouch?(e.annotationFirstTouch=!1,void e.setState({newAnnotationInputOpen:!0})):void 0}},f.a.createElement("canvas",{style:{position:"absolute"},className:"page-canvas",id:"page-canvas-"+(t+1)}),e.state.creatingAnnotationAtPageIndex===r?f.a.createElement(ir.a,{ref:function(t){e.rnd=t},bounds:"parent",size:{width:e.state.newAnnotationWidth,height:e.state.newAnnotationHeight},id:"annotation-being-created",className:"annotation-area",onDragStop:function(t,n){e.setState({newAnnotationX:n.x,newAnnotationY:n.y})},onResizeStop:function(t,n,a,r,o){n=n.toLowerCase(),e.setState({newAnnotationWidth:parseFloat(a.style.width),newAnnotationHeight:parseFloat(a.style.height),newAnnotationX:o.x-(n.includes("left")?r.width:0),newAnnotationY:o.y-(n.includes("top")?r.height:0)})}}):null,void 0!==e.state.annotationsByPage[r]?e.state.annotationsByPage[r].map(function(t){return f.a.createElement(sr.a,{key:t.pk,moveThreshold:10,onTap:function(){"comment"!==e.state.mode&&e.selectAnnotation(t.uuid)}},f.a.createElement("div",{className:"annotation-area",style:{background:t.frame_color,position:"absolute",width:e.state.sampleWidth*t.width_percent,height:e.state.sampleHeight*t.height_percent,left:e.state.sampleWidth*t.left_percent,top:e.state.sampleHeight*t.top_percent},ref:function(n){return e.annotationAreas[t.uuid]=n},"annotation-id":t.pk,"annotation-uuid":t.uuid}))}):null)}));return f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",onClick:function(){e.props.history.goBack()}}),rightContent:[f.a.createElement(kt.a,{key:"1",type:"ellipsis"})],style:{boxShadow:"0px 1px 3px rgba(28, 28, 28, .1)",zIndex:1e7,position:"relative"}},f.a.createElement("span",{className:"document-title"},this.state.document.title)),f.a.createElement(Ca.a,{toast:!0,animating:this.state.loading}),f.a.createElement(sr.a,{moveThreshold:10,onTap:function(t){"comment"!==e.state.mode&&(t.target.classList.contains("page-canvas")&&e.deselectAnnotation(),e.setState({showFloatButton:!e.state.showFloatButton}))}},r),f.a.createElement(Ka.a,{anchor:"bottom",open:this.state.annotationOpen,onClose:function(){return e.deselectAnnotation()},variant:"persistent"},f.a.createElement("div",null,f.a.createElement("div",null,f.a.createElement(ur.a,{component:"span",style:{left:8,padding:6},onClick:function(n){var a=t.page_index,r=e.state.annotationsByPage[a],o=r.indexOf(t),i=void 0;if(o>0)i=r[o-1];else{var l=e.state.annotationsByPage,s=function(e,t){for(var n=e-1;;){if(n<1)return;if(t[n].length>0)return n;n-=1}}(a,l);if(void 0===s)return;var c=l[s];i=c[c.length-1]}e.selectAnnotation(i.uuid),e.annotationAreas[i.uuid].scrollIntoView({block:"start",behavior:"smooth"})}},f.a.createElement(tr.a,null)),f.a.createElement(ur.a,{component:"span",style:{position:"absolute",right:"12vw",padding:6}},f.a.createElement(or.a,null)),f.a.createElement(ur.a,{component:"span",style:{position:"absolute",right:8,padding:6},onClick:function(n){var a=t.page_index,r=e.state.annotationsByPage[a],o=r.indexOf(t),i=void 0;if(o<r.length-1)i=r[o+1];else{var l=e.state.annotationsByPage,s=function(e,t,n){for(var a=e+1;;){if(a>n)return;if(t[a].length>0)return a;a+=1}}(a,l,e.state.numPages);if(void 0===s)return;i=l[s][0]}e.selectAnnotation(i.uuid),e.annotationAreas[i.uuid].scrollIntoView({block:"start",behavior:"smooth"})}},f.a.createElement(ar.a,null))),f.a.createElement("div",{ref:function(t){return e.annotationWrapper=t}},void 0!==t?f.a.createElement(Ga,{document:this.state.document,selectedAnnotation:t,annotationArea:this.annotationAreas[t.uuid],annotations:this.state.annotations,annotationsByPage:this.state.annotationsByPage,setParentState:this.setState.bind(this),pdfDocument:this.state.document}):null))),f.a.createElement(Ka.a,{anchor:"bottom",variant:"persistent",open:this.state.newAnnotationInputOpen},f.a.createElement("div",{style:{textAlign:"center"}},f.a.createElement(St.a,{alt:"User Portrait",style:{float:"left",marginTop:"2%",marginLeft:"2%"},src:this.props.user.portrait_url}),f.a.createElement(At.MuiThemeProvider,{theme:Object(At.createMuiTheme)({palette:{primary:{main:"#3498db"}}})},f.a.createElement(Vn.a,{id:"standard-bare",placeholder:"Type in your comment...",margin:"normal",style:{width:"66vw",top:-2},multiline:!0,fullWidth:!0,value:this.state.newAnnotationContent,onChange:function(t){e.setState({newAnnotationContent:t.target.value})}})),0===this.state.newAnnotationContent.length?f.a.createElement(Ot.a,{icon:["fas","times-circle"],id:"cancel-annotation-btn",onClick:this.cancelCurrentAnnotation}):f.a.createElement(Ot.a,{icon:["fas","paper-plane"],id:"post-annotation-btn",onClick:this.postAnnotation}))),f.a.createElement(Ka.a,{anchor:"bottom",open:this.state.annotationLinearLinkedListOpen,onClose:function(){return e.reopenAnnotationThread()},variant:"persistent"},f.a.createElement("div",{style:{textAlign:"center"}},f.a.createElement(St.a,{alt:"User Portrait",style:{float:"left",marginTop:"2%",marginLeft:"2%"},src:this.props.user.portrait_url}),f.a.createElement(At.MuiThemeProvider,{theme:Object(At.createMuiTheme)({palette:{primary:{main:"#3498db"}}})},f.a.createElement(Vn.a,{ref:function(t){return e.annotationReplyText=t},placeholder:"Type in your reply...",margin:"normal",style:{width:"66vw",top:-2},multiline:!0,fullWidth:!0,value:this.state.newAnnotationReplyContent,onChange:function(t){e.setState({newAnnotationReplyContent:t.target.value})}})),0===this.state.newAnnotationReplyContent.length?f.a.createElement(Ot.a,{icon:["fas","times-circle"],className:"cancel-comment-btn",onClick:this.cancelCurrentAnnotationReply}):f.a.createElement(Ot.a,{icon:["fas","paper-plane"],className:"commit-comment-btn",onClick:this.postAnnotationReply}))),f.a.createElement(Ka.a,{anchor:"bottom",open:this.state.editCommentOpen,onClose:function(){return e.reopenAnnotationThread()},variant:"persistent"},f.a.createElement("div",{style:{textAlign:"center"}},f.a.createElement(St.a,{alt:"User Portrait",style:{float:"left",marginTop:"2%",marginLeft:"2%"},src:this.props.user.portrait_url}),f.a.createElement(At.MuiThemeProvider,{theme:Object(At.createMuiTheme)({palette:{primary:{main:"#3498db"}}})},f.a.createElement(Vn.a,{ref:function(t){return e.editText=t},placeholder:"Type in your edit...",margin:"normal",style:{width:"66vw",top:-2},multiline:!0,fullWidth:!0,value:this.state.editTextContent,onChange:function(t){e.setState({editTextContent:t.target.value})}})),0===this.state.editTextContent.length?f.a.createElement(Ot.a,{icon:["fas","times-circle"],className:"cancel-comment-btn",onClick:this.cancelEdit}):f.a.createElement(Ot.a,{icon:["fas","paper-plane"],className:"commit-comment-btn",onClick:this.postEdit}))),"view"===this.state.mode?f.a.createElement(Za,{color:"rgb(27, 163, 156)",icon:f.a.createElement(Sa.a,{style:{color:"white"}}),show:this.state.showFloatButton,clickCallback:this.changeToCommentMode}):f.a.createElement(Za,{color:"#108ee9",icon:f.a.createElement(Xa.a,{style:{color:"white"}}),show:!0,clickCallback:this.changeToViewMode}))}}]),t}(f.a.Component);var gr=Object(v.b)(function(e){return{user:e.user,coteries:e.coteries}},a)(fr),yr=n(106),vr=n.n(yr),Er=n(274),kr=n.n(Er),br=n(276),Cr=n.n(br),wr=n(278),xr=n.n(wr),Ar=n(277),_r=n.n(Ar),Sr=n(275),Or=n.n(Sr),jr=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={collected:!1,loading:!0},n.onCollectIconClick=function(){var e=n.props.readlists.readlist;if(n.state.isOwner)en.a.fail("You are the owner of this readlist");else{var t=new FormData;t.append("csrfmiddlewaretoken",pn("csrftoken")),n.state.collected?(console.log("uncollectin"),n.props.uncollectReadlist(t,e.slug).then(function(){n.setState({collected:!1}),console.log("uncollected")})):(console.log("collectin"),n.props.collectReadlist(t,e.slug).then(function(){n.setState({collected:!0}),console.log("collected")}))}},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.slug;(function(){var n=Object(ht.a)(mt.a.mark(function n(){var a,r;return mt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.props.getReadlist(t);case 3:return n.next=5,e.props.getUser();case 5:return n.next=7,e.props.getMyReadlists();case 7:n.next=13;break;case 9:return n.prev=9,n.t0=n.catch(0),console.error(n.t0),n.abrupt("return");case 13:a=e.props.user.collectedReadlists.includes(e.props.readlists.readlist.slug),r=e.props.user.pk==e.props.readlists.readlist.owner.pk,console.log(e.props.user),e.setState({collected:a,isOwner:r,loading:!1});case 17:case"end":return n.stop()}},n,this,[[0,9]])}));return function(){return n.apply(this,arguments)}})()()}},{key:"onShareIconClick",value:function(){mn(window.location),en.a.success("Copied to clipboard!",1)}},{key:"renderDocumentList",value:function(){var e=this,t=this.props.readlists.readlist.documents.map(function(t){return f.a.createElement(it.a.Item,{key:t.slug,arrow:"horizontal",thumb:"https://cdn1.iconfinder.com/data/icons/file-types-23/48/PDF-128.png",multipleLine:!0,onClick:function(){e.props.history.push("/documents/".concat(t.slug))}},t.title,f.a.createElement(it.a.Item.Brief,null,nn()(t.upload_time).format("MMMM Do YYYY, h:mm a")))});return f.a.createElement("div",null,f.a.createElement(st.a,null),f.a.createElement(it.a,null,t))}},{key:"renderReadlistCard",value:function(){var e=this,t=this.props.readlists.readlist,n=this.state.isOwner;return f.a.createElement(vr.a,{style:{margin:"15px 15px 5px 15px"}},f.a.createElement(kr.a,null,f.a.createElement(Or.a,{style:{paddingTop:"0",paddingRight:"0"},action:n?f.a.createElement(ur.a,null,f.a.createElement(Tn.a,{onClick:function(){e.props.history.push("/edit-readlist-form/"+e.props.readlists.readlist.slug)}})):f.a.createElement("div",null)}),f.a.createElement("div",{style:{textAlign:"center"}},f.a.createElement(Na.a,{variant:"h5",component:"h5"},t.name),f.a.createElement(Na.a,{variant:"subtitle1",style:{whiteSpace:"pre-wrap",wordBreak:"break-all",hyphens:"auto",fontSize:12,marginTop:12}},t.description),f.a.createElement("br",null),f.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"}},f.a.createElement(St.a,{alt:t.owner.nickname,src:t.owner.portrait_url,style:{width:28,height:28}}),f.a.createElement(Na.a,{variant:"subtitle2",color:"textSecondary",style:{paddingLeft:5}},t.owner.nickname," created ",f.a.createElement(Nt.a,{date:t.create_time}))))),f.a.createElement(Cr.a,null,f.a.createElement(ur.a,{"aria-label":"Add to favorites"},this.state.collected?f.a.createElement(_r.a,{onClick:this.onCollectIconClick}):f.a.createElement(xr.a,{onClick:this.onCollectIconClick})),f.a.createElement(ur.a,{"aria-label":"Share"},f.a.createElement(cn.a,{onClick:this.onShareIconClick}))))}},{key:"render",value:function(){var e=this;return this.state.loading?f.a.createElement("div",null,f.a.createElement(Bt,{title:"Readlists",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5})):f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",history:this.props.history,icon:f.a.createElement(kt.a,{type:"left",onClick:function(){return e.props.history.goBack()}}),style:{boxShadow:"0px 1px 3px rgba(28, 28, 28, .1)",zIndex:1e7,position:"relative"}},f.a.createElement("span",{className:"document-title"},"Readlists")),this.renderReadlistCard(),this.renderDocumentList())}}]),t}(h.Component);var Dr=Object(v.b)(function(e){return{readlists:e.readlists,user:e.user}},a)(jr),Ir=n(279),Rr=n.n(Ir),Mr=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).handleChange=function(e){return function(){console.log(n.state);var t=n.state.readlists;t[e].checked=!t[e].checked,t[e].checked?t[e].count++:t[e].count--,n.setState({readlists:t})}},n.handleSubmit=function(){var e=n.state,t=e.currDocument,a=e.readlists,r=a.filter(function(e){return e.checked}).map(function(e){return e.uuid}),o=a.filter(function(e){return!e.checked}).map(function(e){return e.uuid}),i=new FormData;i.append("csrfmiddlewaretoken",pn("csrftoken"));for(var l=0;l<r.length;l++)i.append("add_readlists[]",r[l]);for(var s=0;s<o.length;s++)i.append("remove_readlists[]",o[s]);n.props.documentChangeReadlists(t.pk,i),n.props.history.goBack()},n.state={loading:!0,currDocument:{},readlists:[]},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.groupUuid;(function(){var n=Object(ht.a)(mt.a.mark(function n(){var a,r,o;return mt.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!t){n.next=4;break}n.next=8;break;case 4:return n.next=6,e.props.getMyDocuments();case 6:return n.next=8,e.props.getMyReadlists();case 8:n.next=14;break;case 10:return n.prev=10,n.t0=n.catch(0),console.error(n.t0),n.abrupt("return");case 14:a=e.props.documents[window.location.href.split("/").pop()],r=a.uuid.replace(/-/g,""),o=e.props.user.createdReadlists.map(function(t){var n=e.props.readlists[t];return{uuid:n.uuid,name:n.name,count:n.documents_uuids.length,checked:n.documents_uuids.includes(r)}}),e.setState({currDocument:a,loading:!1,readlists:o});case 18:case"end":return n.stop()}},n,this,[[0,10]])}));return function(){return n.apply(this,arguments)}})()()}},{key:"renderOwnedReadlists",value:function(){var e=this;if(y.a.isEmpty(this.state.readlists))return f.a.createElement("div",null);var t=this.state.readlists.map(function(t,n){return f.a.createElement("div",{key:t.uuid},f.a.createElement(it.a.Item,{thumb:f.a.createElement(Rr.a,{color:"primary",checked:t.checked,onChange:e.handleChange(n)}),multipleLine:!0},t.name,f.a.createElement(it.a.Item.Brief,null,t.count+" Document(s)")))});return f.a.createElement("div",null,f.a.createElement(it.a,null,t,f.a.createElement(it.a.Item,null,f.a.createElement(vt.a,{type:"primary",style:{backgroundColor:"#1BA39C"},onClick:function(){return e.handleSubmit()}},"OK"))))}},{key:"render",value:function(){var e=this;return this.state.loading?f.a.createElement("div",null,f.a.createElement(Bt,{title:"Add To Readlist",history:this.props.history,match:this.props.match}),f.a.createElement(Pt.a,{style:{color:"#1BA39C",marginTop:"38vh"},size:"10vw",thickness:5})):f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",onClick:function(){return e.props.history.goBack()}}),style:{boxShadow:"0px 1px 3px rgba(28, 28, 28, .1)",zIndex:1e7,position:"relative"}},f.a.createElement("span",{className:"document-title"},"Add To Readlist")),f.a.createElement(Jt.StickyContainer,null,f.a.createElement(st.a,null),f.a.createElement("div",{style:{justifyContent:"center",height:"100%"}},this.renderOwnedReadlists(this.props.user.createdReadlists))),f.a.createElement(st.a,null))}}]),t}(f.a.Component);var Tr=Object(v.b)(function(e){return{readlists:e.readlists,documents:e.documents,user:e.user}},a)(Mr),Br=(n(167),n(96));Mt.b.add(Br.a,Br.b,xt.l,xt.k);var Lr=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={},n.signOff=function(){var e=new FormData;e.append("csrfmiddlewaretoken",pn("csrftoken")),k.a.post("/api/signoff",e).then(function(e){window.location.href="/sign-in"})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",onClick:function(){return e.props.history.goBack()}}),style:{boxShadow:"0px 1px 3px rgba(28, 28, 28, .1)",zIndex:1e7,position:"relative"}},f.a.createElement("span",null,"Profile")),f.a.createElement(vt.a,{type:"primary",style:{backgroundColor:"#1BA39C",marginTop:28},onClick:function(){return e.signOff()}},"Log out"))}}]),t}(f.a.Component),Pr=n(280),Fr=n.n(Pr),Nr=n(105),Ur=n.n(Nr),zr=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).onChange=function(e){e.preventDefault();var t=e.target.value,a=n.props.match.params.groupUuid;if(n.setState({searchTerm:t}),""!==t){if(a)return void n.props.getCoterieSearchResults(t,a);n.props.getSearchResults(t)}},n.state={loading:!1,searchTerm:""},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.getMyCoteries()}},{key:"renderSearchResultList",value:function(e){var t=this;if(!e||""===this.state.searchTerm)return f.a.createElement("div",null);var n=this.props.match.params.groupUuid,a=[],r="/documents/";if(n&&(r="/group-documents/"),e.documents){var o=e.documents.map(function(e){return{sortKey:e.title,jsx:f.a.createElement(it.a.Item,{key:e.slug,arrow:"horizontal",thumb:"https://cdn1.iconfinder.com/data/icons/file-types-23/48/PDF-128.png",multipleLine:!0,onClick:function(){t.props.history.push(r+"".concat(e.slug))}},e.title,f.a.createElement(it.a.Item.Brief,null,"Uploaded by ",e.uploader_name,", ",f.a.createElement(Nt.a,{date:e.upload_time})))}});a=a.concat(o)}if(e.readlists){var i=e.readlists.map(function(e){return{sortKey:e.name,jsx:f.a.createElement(it.a.Item,{key:e.slug,arrow:"horizontal",thumb:"https://cdn0.iconfinder.com/data/icons/small-n-flat/24/678072-folder-document-512.png",multipleLine:!0,onClick:function(){t.props.history.push("readlists/".concat(e.slug))}},e.name,f.a.createElement(it.a.Item.Brief,null,"Created by ",e.owner.nickname,", ",f.a.createElement(Nt.a,{date:e.create_time})))}});a=a.concat(i)}if(e.users){var l=e.users.map(function(e){return{sortKey:e.nickname,jsx:f.a.createElement(it.a.Item,{key:e.pk,arrow:"horizontal",thumb:e.portrait_url,multipleLine:!0,onClick:function(){console.log("user with pk "+e.pk+" clicked")}},e.nickname,f.a.createElement(it.a.Item.Brief,null,e.email_address))}});a=a.concat(l)}return a=a.sort(function(e,t){return(""+e.sortKey).localeCompare(t.sortKey)}).map(function(e){return e.jsx}),f.a.createElement("div",null,f.a.createElement(it.a,null,a))}},{key:"render",value:function(){var e=this,t="Search globally..";return this.props.match.params.groupUuid&&this.props.coteries[this.props.match.params.groupUuid]&&(t="Search within "+this.props.coteries[this.props.match.params.groupUuid].name),f.a.createElement("div",null,f.a.createElement(gt.a,{mode:"light",icon:f.a.createElement(kt.a,{type:"left",onClick:function(){return e.props.history.goBack()}}),style:{boxShadow:"0px 1px 3px rgba(28, 28, 28, .1)",zIndex:1e7,position:"relative"}},f.a.createElement("span",{className:"document-title"},f.a.createElement(Fr.a,null,f.a.createElement(Ur.a,{placeholder:t,autoFocus:!0,value:this.state.searchTerm||"",onChange:this.onChange,fullWidth:!0})))),f.a.createElement(st.a,null),f.a.createElement(Jt.StickyContainer,null,f.a.createElement("div",{style:{justifyContent:"center",height:"100%"}},this.renderSearchResultList(this.props.search))),f.a.createElement(st.a,null))}}]),t}(f.a.Component);var Hr=Object(v.b)(function(e){return{search:e.search,coteries:e.coteries}},a)(zr);n(608);Mt.b.add(Br.a,Br.b,xt.l,xt.k);var Yr=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={isAuthenticated:!1,username:"",password:"",token:"",errorMessage:!1};var a=Object(xa.a)(Object(xa.a)(n));return n.clickLogin=function(){var e=new FormData;e.append("email_address",this.state.username),e.append("password",this.state.password),e.append("csrfmiddlewaretoken",pn("csrftoken")),k.a.post("/api/signin",e).then(function(e){200===e.status&&a.props.history.push("/uploads")}).catch(function(e){console.log(e),a.setState({errorMessage:!0}),en.a.offline("Email or password incorrect",1.8)})},n.facebookLogin=function(){FB.login(function(e){var t=new FormData;t.append("csrfmiddlewaretoken",pn("csrftoken")),t.append("auth_response",JSON.stringify(e.authResponse)),k.a.post("/api/signin/facebook",t).then(function(e){window.location.href="/"}).catch(function(e){en.a.offline("Facebook login unsuccessful",1.8)})},{scope:"email"})},n.handleMessageClose=function(e,t){"clickaway"!==t&&n.setState({errorMessage:!1})},n}return Object(m.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function(e,t,n){var a,r=e.getElementsByTagName(t)[0];e.getElementById(n)||((a=e.createElement(t)).id=n,a.src="https://connect.facebook.net/en_US/sdk.js",r.parentNode.insertBefore(a,r))}(document,"script","facebook-jssdk"),window.fbAsyncInit=function(){FB.init({appId:"213151942857648",cookie:!0,xfbml:!0,version:"v3.0"}),FB.AppEvents.logPageView(),e.setState({fbLoginButtonLoading:!1})};var t=void 0;gapi.load("auth2",function(){var e;t=gapi.auth2.init({client_id:"887521980338-fj0n0r7ui5cn313f4vh6paqm411upf3o.apps.googleusercontent.com",cookiepolicy:"single_host_origin"}),e=document.getElementById("google-button"),t.attachClickHandler(e,{},function(e){var t=new FormData;t.append("csrfmiddlewaretoken",pn("csrftoken")),t.append("id_token",e.getAuthResponse().id_token),k.a.post("/api/signin/google",t).then(function(e){window.location.href="/"}).catch(function(e){console.log(e.response),en.a.offline("Google login unsuccessful",1.8)})},function(e){console.log(JSON.stringify(e,void 0,2)),en.a.offline("Google login unsuccessful",1.8)})})}},{key:"render",value:function(){var e=this;return f.a.createElement("div",null,f.a.createElement(vr.a,{id:"login-card"},f.a.createElement("div",{className:"social",id:"logo-div"},f.a.createElement("img",{id:"logo",src:sa.a})),f.a.createElement("div",{className:"social"},f.a.createElement(Wn.a,{variant:"contained",size:"small",id:"google-button",className:"social-button"},f.a.createElement(Ot.a,{icon:["fab","google"],className:"social-icon"}),f.a.createElement("span",{className:"social-text"},"Log in with Google"))),f.a.createElement(st.a,{size:"lg"}),f.a.createElement(st.a,{size:"lg"}),f.a.createElement("div",{className:"social"},f.a.createElement(Wn.a,{variant:"contained",color:"primary",size:"small",id:"facebook-button",className:"social-button",onClick:this.facebookLogin},f.a.createElement(Ot.a,{icon:["fab","facebook"],className:"social-icon"}),f.a.createElement("span",{className:"social-text"},"Log in with Facebook"))),f.a.createElement(st.a,{size:"lg"}),f.a.createElement(st.a,{size:"lg"}),f.a.createElement("div",{style:{textAlign:"center"}},f.a.createElement(Vn.a,{className:"input-width",label:"Email Address",value:this.state.username,onChange:function(t){e.setState({username:t.target.value})}}),f.a.createElement(st.a,{size:"lg"}),f.a.createElement(Vn.a,{className:"input-width",type:"password",label:"Password",value:this.state.password,onChange:function(t){return e.setState({password:t.target.value})}})),f.a.createElement(st.a,{size:"lg"}),f.a.createElement(st.a,{size:"lg"}),f.a.createElement("div",{className:"social"},f.a.createElement(Wn.a,{onClick:function(t){return e.clickLogin()},variant:"outlined",color:"primary",size:"small",className:"social-button"},f.a.createElement(kt.a,{type:"check-circle-o",id:"submit-icon",style:{color:"#1BA39C",marginRight:8}}),f.a.createElement("span",{className:"login-text",style:{color:"#1BA39C"}},"Log in"))),f.a.createElement(st.a,{size:"lg"}),f.a.createElement("div",{className:"social"},f.a.createElement(Wn.a,{color:"primary",size:"small",className:"social-butto"},f.a.createElement("span",{className:"login-text",style:{color:"#1BA39C"}},"Create an Account ",f.a.createElement("br",null),"(Coming soon)")))))}}]),t}(f.a.Component),Wr=n(281),Gr=n.n(Wr),Vr=n(282),Xr=Object(s.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b:var n=t.payload.data;return y.a.extend({},e,n);case C:var a=t.payload.data.uploadedDocuments,r=t.payload.data.collectedDocuments;return y.a.extend({},e,{uploadedDocuments:y.a.map(a,"slug"),collectedDocuments:y.a.map(r,"slug")});case w:var o=t.payload.data;return y.a.extend({},e,{uploadedDocuments:y.a.map(o,"slug"),collectedDocuments:[]});case A:case J:var i=y.a.concat(e.uploadedDocuments,t.payload.data.slug);return y.a.extend({},e,{uploadedDocuments:i});case S:var l=y.a.filter(e.uploadedDocuments,function(e){return e!==t.payload}),s=y.a.filter(e.collectedDocuments,function(e){return e!==t.payload});return y.a.extend({},e,{uploadedDocuments:l,collectedDocuments:s});case O:var c=y.a.filter(e.collectedDocuments,function(e){return e!==t.payload});return y.a.extend({},e,{collectedDocuments:c});case H:var u=t.payload.data.joinedCoteries,d=t.payload.data.administratedCoteries;return y.a.extend({},e,{joinedCoteries:y.a.map(u,"uuid"),administratedCoteries:y.a.map(d,"uuid")});case K:var p=y.a.filter(e.joinedCoteries,function(e){return e!==t.uuid});return y.a.extend({},e,{joinedCoteries:p});case q:var m=y.a.filter(e.administratedCoteries,function(e){return e!==t.uuid});return y.a.extend({},e,{administratedCoteries:m});case j:var h=t.payload.data.created_readlists,f=t.payload.data.collected_readlists;return y.a.extend({},e,{createdReadlists:y.a.map(h,"slug"),collectedReadlists:y.a.map(f,"slug")});default:return e}},documents:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case C:var n=t.payload.data.uploadedDocuments,a=t.payload.data.collectedDocuments;return y.a.extend(y.a.extend({},e,y.a.keyBy(n,"slug")),y.a.keyBy(a,"slug"));case w:var r=t.payload.data;return y.a.extend({},e,y.a.keyBy(r,"slug"));case A:case J:var o=t.payload.data;return y.a.extend({},e,Object(wt.a)({},o.slug,o));case _:var i=t.payload.data;return y.a.extend({},e,Object(wt.a)({},i.slug,i));case S:return y.a.omit(e,t.payload);default:return e}},coteries:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case H:var n=t.payload.data.joinedCoteries,a=t.payload.data.administratedCoteries;return y.a.extend(y.a.extend({},e,y.a.keyBy(n,"uuid")),y.a.keyBy(a,"uuid"));case Y:var r=t.payload.data;return y.a.extend({},e,Object(wt.a)({},r.uuid,r));case q:return y.a.omit(e,t.uuid);case G:var o=e[t.payload.uuid];return t.payload.name&&(o.name=t.payload.name),t.payload.description&&(o.description=t.payload.description),y.a.extend({},e,Object(wt.a)({},t.payload.uuid,o));case X:console.log(t);var i=e[t.payload.uuid];return i.members=i.members.filter(function(e){return e.email_address!==t.payload.email}),y.a.extend({},e,Object(wt.a)({},i.uuid,i));default:return e}},readlists:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case I:var n=t.payload.data;return y.a.extend({},e,{readlist:n});case j:var a=t.payload.data.created_readlists,r=t.payload.data.collected_readlists;return y.a.extend(y.a.extend({},e,y.a.keyBy(a,"slug")),y.a.keyBy(r,"slug"));default:return e}},explore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case x:var n=t.payload.data.filter(function(e){return"most_views"===e.description}),a=t.payload.data.filter(function(e){return"most_collectors"===e.description}),r=t.payload.data.filter(function(e){return"most_annotations"===e.description});return y.a.extend({},e,{documents:{mostViewsDocuments:n,mostStarsDocuments:a,mostAnnotationsDocuments:r}});case D:var o=t.payload.data.most_collectors_readlists,i=t.payload.data.newest_readlists;return y.a.extend({},e,{readlists:{mostCollectorsReadlists:o,newestReadlists:i}});default:return e}},notifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case F:var n=t.payload.data;return y.a.extend({},e,y.a.keyBy(n,"slug"));case N:var a=e[t.slug];return a.unread=!1,y.a.extend({},e,Object(wt.a)({},a.slug,a));default:return e}},invitations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Q:var n=t.payload.data;return y.a.extend({},e,y.a.keyBy(n,"pk"));case $:case Z:return y.a.omit(e,t.pk);default:return e}},search:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:var n=t.payload.data.resultReadlists,a=t.payload.data.resultDocuments,r=t.payload.data.resultUsers;return y.a.extend({},e,{readlists:n,documents:a,users:r});case z:return{};default:return e}}}),Jr=Object(At.createMuiTheme)({typography:{useNextVariants:!0,suppressDeprecationWarnings:!0},palette:{primary:{main:"#1BA39C"}}}),Kr=Object(s.e)(Xr,Object(s.d)(Object(s.a)(Gr.a,Vr.a)));Pa.a.render(f.a.createElement(At.MuiThemeProvider,{theme:Jr},f.a.createElement(v.a,{store:Kr},f.a.createElement(r.a,null,f.a.createElement(o.a,null,f.a.createElement(i.a,{path:"/documents/:slug",render:function(e){return function(e,t,n){return f.a.createElement(gr,{isGroupDocument:!1,match:e,location:t,history:n})}(e.match,e.location,e.history)}}),f.a.createElement(i.a,{path:"/coteries/:coterieId/documents/:slug",render:function(e){return function(e,t,n){return f.a.createElement(gr,{isGroupDocument:!0,match:e,location:t,history:n})}(e.match,e.location,e.history)}}),f.a.createElement(i.a,{path:"/readlists/:slug",component:Dr}),f.a.createElement(i.a,{path:"/search/:groupUuid",component:Hr}),f.a.createElement(i.a,{path:"/search",component:Hr}),f.a.createElement(i.a,{path:"/profile",component:Lr}),f.a.createElement(i.a,{path:"/add-to-readlists",component:Tr}),f.a.createElement(i.a,{path:"/create-coterie-form",component:ga}),f.a.createElement(i.a,{path:"/create-readlist-form",component:va}),f.a.createElement(i.a,{path:"/edit-readlist-form/:slug",component:ka}),f.a.createElement(i.a,{path:"/sign-in",component:Yr}),f.a.createElement(i.a,{exact:!0,path:"/",render:function(){return f.a.createElement(l.a,{to:"/uploads"})}}),f.a.createElement(i.a,{path:"/",component:ua}))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[286,2,1]]]);
//# sourceMappingURL=main.1a4dfc1b.chunk.js.map